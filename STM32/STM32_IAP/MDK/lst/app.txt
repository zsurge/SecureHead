; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\app.o --asm_dir=.\lst\ --list_dir=.\lst\ --depend=.\obj\app.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\user -I..\dev -I..\lib\inc -I..\core_cm3 -ID:\Keil\ARM\RV31\INC -ID:\Keil\ARM\CMSIS\Include -ID:\Keil\ARM\Inc\ST\STM32F10x -D__MICROLIB -DSTM32F10X_MD -DUSE_STDPERIPH_DRIVER --omf_browse=.\obj\app.crf ..\user\app.c]
                          THUMB

                          AREA ||i.AsciiToHex||, CODE, READONLY, ALIGN=1

                  AsciiToHex PROC
;;;189    ***************************************************************************************/
;;;190    uint8_t AsciiToHex(uint8_t *pAscii, uint8_t *pHex, int nLen)
000000  b5f8              PUSH     {r3-r7,lr}
;;;191    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;192    	unsigned char Nibble[2];
;;;193    	int nHexLen,i,j;
;;;194    	if (nLen%2)
000006  4610              MOV      r0,r2
000008  eb0277d0          ADD      r7,r2,r0,LSR #31
00000c  107f              ASRS     r7,r7,#1
00000e  ebb20747          SUBS     r7,r2,r7,LSL #1
000012  d001              BEQ      |L1.24|
;;;195    		return FALSE;
000014  2000              MOVS     r0,#0
                  |L1.22|
;;;196    	nHexLen = nLen/2;
;;;197    	for (i = 0; i < nHexLen; i ++)
;;;198    	{
;;;199    		
;;;200    		Nibble[0] = *pAscii++;
;;;201    		Nibble[1] = *pAscii++;
;;;202    		for (j = 0; j < 2; j++)
;;;203    		{
;;;204    			if (Nibble[j] <= 'F' && Nibble[j] >= 'A')
;;;205    				Nibble[j] = Nibble[j] - 'A' + 10;
;;;206    			else if (Nibble[j] <= 'f' && Nibble[j] >= 'a')
;;;207    					Nibble[j] = Nibble[j] - 'a' + 10;
;;;208    			else if (Nibble[j] >= '0' && Nibble[j] <= '9')
;;;209    					Nibble [j] = Nibble[j] - '0';
;;;210    			else
;;;211    				return FALSE;
;;;212    		}	// for (int j = ...)
;;;213    		pHex[i] = Nibble[0] << 4;	// Set the high nibble
;;;214    		pHex[i] |= Nibble[1];		//Set the low nibble
;;;215    	}	// for (int i = ...)
;;;216    	return TRUE;
;;;217    }
000016  bdf8              POP      {r3-r7,pc}
                  |L1.24|
000018  4610              MOV      r0,r2                 ;196
00001a  eb0277d0          ADD      r7,r2,r0,LSR #31      ;196
00001e  107e              ASRS     r6,r7,#1              ;196
000020  2300              MOVS     r3,#0                 ;197
000022  e046              B        |L1.178|
                  |L1.36|
000024  f8140b01          LDRB     r0,[r4],#1            ;200
000028  f88d0000          STRB     r0,[sp,#0]            ;200
00002c  f8140b01          LDRB     r0,[r4],#1            ;201
000030  f88d0001          STRB     r0,[sp,#1]            ;201
000034  2100              MOVS     r1,#0                 ;202
000036  e02f              B        |L1.152|
                  |L1.56|
000038  f81d0001          LDRB     r0,[sp,r1]            ;204
00003c  2846              CMP      r0,#0x46              ;204
00003e  dc0a              BGT      |L1.86|
000040  f81d0001          LDRB     r0,[sp,r1]            ;204
000044  2841              CMP      r0,#0x41              ;204
000046  db06              BLT      |L1.86|
000048  f81d0001          LDRB     r0,[sp,r1]            ;205
00004c  3837              SUBS     r0,r0,#0x37           ;205
00004e  b2c0              UXTB     r0,r0                 ;205
000050  f80d0001          STRB     r0,[sp,r1]            ;205
000054  e01f              B        |L1.150|
                  |L1.86|
000056  f81d0001          LDRB     r0,[sp,r1]            ;206
00005a  2866              CMP      r0,#0x66              ;206
00005c  dc0a              BGT      |L1.116|
00005e  f81d0001          LDRB     r0,[sp,r1]            ;206
000062  2861              CMP      r0,#0x61              ;206
000064  db06              BLT      |L1.116|
000066  f81d0001          LDRB     r0,[sp,r1]            ;207
00006a  3857              SUBS     r0,r0,#0x57           ;207
00006c  b2c0              UXTB     r0,r0                 ;207
00006e  f80d0001          STRB     r0,[sp,r1]            ;207
000072  e010              B        |L1.150|
                  |L1.116|
000074  f81d0001          LDRB     r0,[sp,r1]            ;208
000078  2830              CMP      r0,#0x30              ;208
00007a  db0a              BLT      |L1.146|
00007c  f81d0001          LDRB     r0,[sp,r1]            ;208
000080  2839              CMP      r0,#0x39              ;208
000082  dc06              BGT      |L1.146|
000084  f81d0001          LDRB     r0,[sp,r1]            ;209
000088  3830              SUBS     r0,r0,#0x30           ;209
00008a  b2c0              UXTB     r0,r0                 ;209
00008c  f80d0001          STRB     r0,[sp,r1]            ;209
000090  e001              B        |L1.150|
                  |L1.146|
000092  2000              MOVS     r0,#0                 ;211
000094  e7bf              B        |L1.22|
                  |L1.150|
000096  1c49              ADDS     r1,r1,#1              ;202
                  |L1.152|
000098  2902              CMP      r1,#2                 ;202
00009a  dbcd              BLT      |L1.56|
00009c  f89d0000          LDRB     r0,[sp,#0]            ;213
0000a0  0700              LSLS     r0,r0,#28             ;213
0000a2  0e00              LSRS     r0,r0,#24             ;213
0000a4  54e8              STRB     r0,[r5,r3]            ;213
0000a6  5ce8              LDRB     r0,[r5,r3]            ;214
0000a8  f89d7001          LDRB     r7,[sp,#1]            ;214
0000ac  4338              ORRS     r0,r0,r7              ;214
0000ae  54e8              STRB     r0,[r5,r3]            ;214
0000b0  1c5b              ADDS     r3,r3,#1              ;197
                  |L1.178|
0000b2  42b3              CMP      r3,r6                 ;197
0000b4  dbb6              BLT      |L1.36|
0000b6  2001              MOVS     r0,#1                 ;216
0000b8  e7ad              B        |L1.22|
;;;218    
                          ENDP


                          AREA ||i.BOOT_boot||, CODE, READONLY, ALIGN=2

                  BOOT_boot PROC
;;;85      *****************************************************************************/
;;;86     void BOOT_boot(void)
000000  b510              PUSH     {r4,lr}
;;;87     {
;;;88     	/* Clear all interrupts set. */
;;;89     	NVIC->ICER[0] = 0xFFFFFFFF;
000002  f04f30ff          MOV      r0,#0xffffffff
000006  490a              LDR      r1,|L2.48|
000008  6008              STR      r0,[r1,#0]
;;;90     	NVIC->ICER[1] = 0xFFFFFFFF;
00000a  4601              MOV      r1,r0
00000c  4809              LDR      r0,|L2.52|
00000e  f8c01084          STR      r1,[r0,#0x84]
;;;91     
;;;92     	/* Set new vector table */
;;;93     	SCB->VTOR = (uint32_t) BOOT_ADDR;
000012  f04f0000          MOV      r0,#0
000016  4908              LDR      r1,|L2.56|
000018  6008              STR      r0,[r1,#0]
;;;94     
;;;95     	SCB->AIRCR = 0x05FA0004;
00001a  4808              LDR      r0,|L2.60|
00001c  f1010104          ADD      r1,r1,#4
000020  6008              STR      r0,[r1,#0]
;;;96     
;;;97     	/* Read new SP and PC from vector table */
;;;98     	BOOT_jump(*((uint32_t *) BOOT_ADDR),*((uint32_t *) BOOT_ADDR + 1));
000022  f04f0200          MOV      r2,#0
000026  ca03              LDM      r2!,{r0,r1}
000028  f7fffffe          BL       BOOT_jump
;;;99     }
00002c  bd10              POP      {r4,pc}
;;;100    
                          ENDP

00002e  0000              DCW      0x0000
                  |L2.48|
                          DCD      0xe000e180
                  |L2.52|
                          DCD      0xe000e100
                  |L2.56|
                          DCD      0xe000ed08
                  |L2.60|
                          DCD      0x05fa0004

                          AREA ||i.CalcCryptoKey||, CODE, READONLY, ALIGN=2

                  CalcCryptoKey PROC
;;;316    ***************************************************************************************/
;;;317    void CalcCryptoKey(void) 
000000  b5f8              PUSH     {r3-r7,lr}
;;;318    {
;;;319    	int counter;
;;;320    	uint8_t k=1;
000002  2401              MOVS     r4,#1
;;;321    	//GetNextKSN();
;;;322    	GetNextFlag = 1;
000004  2001              MOVS     r0,#1
000006  4916              LDR      r1,|L3.96|
000008  7008              STRB     r0,[r1,#0]
;;;323    	IDT_LoadInitKey(1,ENC_KEY.temp.key,ENC_KEY.temp.ksn);
00000a  4a16              LDR      r2,|L3.100|
00000c  f1a20110          SUB      r1,r2,#0x10
000010  f7fffffe          BL       IDT_LoadInitKey
;;;324    	counter = ENC_KEY.temp.ksn[9] | (ENC_KEY.temp.ksn[8] << 8) | ((ENC_KEY.temp.ksn[7] & 0x1f) << 16);
000014  4813              LDR      r0,|L3.100|
000016  3824              SUBS     r0,r0,#0x24
000018  f890102d          LDRB     r1,[r0,#0x2d]
00001c  f890002c          LDRB     r0,[r0,#0x2c]
000020  ea412100          ORR      r1,r1,r0,LSL #8
000024  480f              LDR      r0,|L3.100|
000026  3824              SUBS     r0,r0,#0x24
000028  f890002b          LDRB     r0,[r0,#0x2b]
00002c  f000001f          AND      r0,r0,#0x1f
000030  ea414500          ORR      r5,r1,r0,LSL #16
;;;325    	do
000034  bf00              NOP      
                  |L3.54|
;;;326    	{	       
;;;327    		IDT_EncryptPIN(1,IDT_ChangeCounter(counter, k),ENC_KEY.temp.ksn,CryptoKey,0); 
000036  4621              MOV      r1,r4
000038  4628              MOV      r0,r5
00003a  f7fffffe          BL       IDT_ChangeCounter
00003e  4606              MOV      r6,r0
000040  2000              MOVS     r0,#0
000042  4b09              LDR      r3,|L3.104|
000044  4a07              LDR      r2,|L3.100|
000046  4631              MOV      r1,r6
000048  9000              STR      r0,[sp,#0]
00004a  2001              MOVS     r0,#1
00004c  f7fffffe          BL       IDT_EncryptPIN
;;;328    		k++;
000050  1c60              ADDS     r0,r4,#1
000052  b2c4              UXTB     r4,r0
;;;329    	}while(k <= IDT_GetNumOfOnes(counter));
000054  4628              MOV      r0,r5
000056  f7fffffe          BL       IDT_GetNumOfOnes
00005a  42a0              CMP      r0,r4
00005c  daeb              BGE      |L3.54|
;;;330    }
00005e  bdf8              POP      {r3-r7,pc}
;;;331    
                          ENDP

                  |L3.96|
                          DCD      GetNextFlag
                  |L3.100|
                          DCD      ENC_KEY+0x24
                  |L3.104|
                          DCD      CryptoKey

                          AREA ||i.DealRxData||, CODE, READONLY, ALIGN=2

                  DealRxData PROC
;;;730    ***************************************************************************************/
;;;731    void DealRxData(void)
000000  b570              PUSH     {r4-r6,lr}
;;;732    {
;;;733    	uint16_t i;
;;;734    	uint8_t bcc = 0;
000002  2500              MOVS     r5,#0
;;;735        
;;;736    	if (FINISH == RxdFrameStatus)
000004  48fd              LDR      r0,|L4.1020|
000006  7800              LDRB     r0,[r0,#0]  ; RxdFrameStatus
000008  2855              CMP      r0,#0x55
                  |L4.10|
00000a  d133              BNE      |L4.116|
;;;737    	{
;;;738    		//spi_send(RxdBuf,RxdTotalLen);
;;;739    		IWDG_ReloadCounter();
00000c  f7fffffe          BL       IWDG_ReloadCounter
;;;740    		if (RxdBuf[0] == SOH)									//解析01数据包
000010  48fb              LDR      r0,|L4.1024|
000012  7800              LDRB     r0,[r0,#0]  ; TempTrackDirtData
000014  2801              CMP      r0,#1
000016  d131              BNE      |L4.124|
;;;741    		{
;;;742    			for (i = 0; i < RxdTotalLen - 1; i++)				//计算累加和
000018  2400              MOVS     r4,#0
00001a  e005              B        |L4.40|
                  |L4.28|
;;;743    			{
;;;744    				bcc += RxdBuf[i];
00001c  48f8              LDR      r0,|L4.1024|
00001e  5d00              LDRB     r0,[r0,r4]
000020  4428              ADD      r0,r0,r5
000022  b2c5              UXTB     r5,r0
000024  1c60              ADDS     r0,r4,#1              ;742
000026  b284              UXTH     r4,r0                 ;742
                  |L4.40|
000028  48f6              LDR      r0,|L4.1028|
00002a  7800              LDRB     r0,[r0,#0]            ;742  ; RxdTotalLen
00002c  1e40              SUBS     r0,r0,#1              ;742
00002e  42a0              CMP      r0,r4                 ;742
000030  dcf4              BGT      |L4.28|
;;;745    			}
;;;746    			if (bcc == RxdBuf[RxdTotalLen -1])
000032  48f4              LDR      r0,|L4.1028|
000034  7800              LDRB     r0,[r0,#0]  ; RxdTotalLen
000036  1e40              SUBS     r0,r0,#1
000038  49f1              LDR      r1,|L4.1024|
00003a  5c08              LDRB     r0,[r1,r0]
00003c  42a8              CMP      r0,r5
00003e  d11a              BNE      |L4.118|
;;;747    			{
;;;748    				if (ORDER == RxdBuf[1])
000040  4608              MOV      r0,r1
000042  7840              LDRB     r0,[r0,#1]  ; TempTrackDirtData
000044  2813              CMP      r0,#0x13
000046  d1e0              BNE      |L4.10|
;;;749    				{
;;;750    					switch (RxdBuf[2])
000048  4608              MOV      r0,r1
00004a  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
00004c  28ae              CMP      r0,#0xae
00004e  d006              BEQ      |L4.94|
000050  28be              CMP      r0,#0xbe
000052  d10c              BNE      |L4.110|
;;;751    					{
;;;752    						case READ_VERSION:						 //读应用版本
;;;753    								send_frame(READ_VERSION);
000054  f7fffffe          BL       send_frame
;;;754    								init_serial_boot();
000058  f7fffffe          BL       init_serial_boot
;;;755    								break;
00005c  e00a              B        |L4.116|
                  |L4.94|
;;;756    						case REQUEST_DOWN:       				/* request download */
;;;757    								send_frame(ENABLE_DOWN);
00005e  20a1              MOVS     r0,#0xa1
000060  f7fffffe          BL       send_frame
;;;758    								init_serial_boot();
000064  f7fffffe          BL       init_serial_boot
;;;759    								//Delay(3);
;;;760    								BOOT_boot();					 //跳转到Boot启动下载
000068  f7fffffe          BL       BOOT_boot
;;;761    								break;
00006c  e002              B        |L4.116|
                  |L4.110|
;;;762    						default:
;;;763    								init_serial_boot();
00006e  f7fffffe          BL       init_serial_boot
;;;764                					break;
000072  bf00              NOP      
                  |L4.116|
000074  e2d7              B        |L4.1574|
                  |L4.118|
;;;765    					}
;;;766    				}	
;;;767    			}
;;;768    			else
;;;769    			{
;;;770    				init_serial_boot();
000076  f7fffffe          BL       init_serial_boot
00007a  e2d4              B        |L4.1574|
                  |L4.124|
;;;771    			}
;;;772    		}
;;;773    		else if(RxdBuf[0] == STX)									//解析02数据包
00007c  48e0              LDR      r0,|L4.1024|
00007e  7800              LDRB     r0,[r0,#0]  ; TempTrackDirtData
000080  2802              CMP      r0,#2
000082  d17d              BNE      |L4.384|
;;;774    		{
;;;775    			for (i = 0; i < RxdTotalLen - 1; i++)			 	   //计算异或和
000084  2400              MOVS     r4,#0
000086  e004              B        |L4.146|
                  |L4.136|
;;;776    			{
;;;777    					bcc ^= RxdBuf[i];
000088  48dd              LDR      r0,|L4.1024|
00008a  5d00              LDRB     r0,[r0,r4]
00008c  4045              EORS     r5,r5,r0
00008e  1c60              ADDS     r0,r4,#1              ;775
000090  b284              UXTH     r4,r0                 ;775
                  |L4.146|
000092  48dc              LDR      r0,|L4.1028|
000094  7800              LDRB     r0,[r0,#0]            ;775  ; RxdTotalLen
000096  1e40              SUBS     r0,r0,#1              ;775
000098  42a0              CMP      r0,r4                 ;775
00009a  dcf5              BGT      |L4.136|
;;;778    			}
;;;779    			if (bcc == RxdBuf[RxdTotalLen -1] || (bcc^0x02) == RxdBuf[RxdTotalLen -1] )
00009c  48d9              LDR      r0,|L4.1028|
00009e  7800              LDRB     r0,[r0,#0]  ; RxdTotalLen
0000a0  1e40              SUBS     r0,r0,#1
0000a2  49d7              LDR      r1,|L4.1024|
0000a4  5c08              LDRB     r0,[r1,r0]
0000a6  42a8              CMP      r0,r5
0000a8  d008              BEQ      |L4.188|
0000aa  f0850102          EOR      r1,r5,#2
0000ae  48d5              LDR      r0,|L4.1028|
0000b0  7800              LDRB     r0,[r0,#0]  ; RxdTotalLen
0000b2  1e40              SUBS     r0,r0,#1
0000b4  4ad2              LDR      r2,|L4.1024|
0000b6  5c10              LDRB     r0,[r2,r0]
0000b8  4281              CMP      r1,r0
0000ba  d1db              BNE      |L4.116|
                  |L4.188|
;;;780    			{
;;;781    				if (RESETHEAD == RxdBuf[1])							//0x38	/* reset secureheadreader */
0000bc  48d0              LDR      r0,|L4.1024|
0000be  7840              LDRB     r0,[r0,#1]  ; TempTrackDirtData
0000c0  2838              CMP      r0,#0x38
0000c2  d117              BNE      |L4.244|
;;;782    				{
;;;783    					SetKeyFlag = 0;
0000c4  2000              MOVS     r0,#0
0000c6  49d0              LDR      r1,|L4.1032|
0000c8  7008              STRB     r0,[r1,#0]
;;;784    					memset(ENC_KEY.key,0x00,64);
0000ca  2140              MOVS     r1,#0x40
0000cc  48cf              LDR      r0,|L4.1036|
0000ce  f7fffffe          BL       __aeabi_memclr
;;;785    					ENC_KEY.temp.level = 0x31;
0000d2  2031              MOVS     r0,#0x31
0000d4  49cd              LDR      r1,|L4.1036|
0000d6  7048              STRB     r0,[r1,#1]
;;;786    					WriteFlag = 1;
0000d8  2001              MOVS     r0,#1
0000da  49cd              LDR      r1,|L4.1040|
0000dc  7008              STRB     r0,[r1,#0]
;;;787    					WriteENCKEY();
0000de  f7fffffe          BL       WriteENCKEY
;;;788    					send_frame(CMDSUCC);
0000e2  2006              MOVS     r0,#6
0000e4  f7fffffe          BL       send_frame
;;;789    //					else
;;;790    //						send_frame(CMDERRO);
;;;791    					WriteFlag = 0;
0000e8  2000              MOVS     r0,#0
0000ea  49c9              LDR      r1,|L4.1040|
0000ec  7008              STRB     r0,[r1,#0]
;;;792    					init_serial_boot();
0000ee  f7fffffe          BL       init_serial_boot
0000f2  e298              B        |L4.1574|
                  |L4.244|
;;;793    				}
;;;794    				else if (SETKEY == RxdBuf[1] && SETKEY == RxdBuf[2])	//0x46	/* set key commands  */
0000f4  48c2              LDR      r0,|L4.1024|
0000f6  7840              LDRB     r0,[r0,#1]  ; TempTrackDirtData
0000f8  2846              CMP      r0,#0x46
                  |L4.250|
0000fa  d16e              BNE      |L4.474|
0000fc  48c0              LDR      r0,|L4.1024|
0000fe  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000100  2846              CMP      r0,#0x46
000102  d1fa              BNE      |L4.250|
;;;795    				{
;;;796    					memset(SetKeyBuf,0,sizeof(SetKeyBuf));
000104  48c3              LDR      r0,|L4.1044|
000106  2100              MOVS     r1,#0
000108  6001              STR      r1,[r0,#0]  ; TempTrackData
;;;797    					SetKeyLen = from64tobits(SetKeyBuf,&RxdBuf[3],RxdTotalLen-7);
00010a  48be              LDR      r0,|L4.1028|
00010c  7800              LDRB     r0,[r0,#0]  ; RxdTotalLen
00010e  1fc2              SUBS     r2,r0,#7
000110  49bb              LDR      r1,|L4.1024|
000112  1cc9              ADDS     r1,r1,#3
000114  48bf              LDR      r0,|L4.1044|
000116  f7fffffe          BL       from64tobits
00011a  49bf              LDR      r1,|L4.1048|
00011c  7008              STRB     r0,[r1,#0]
;;;798    					if(SetKeyBuf[0] == SETKEYHEAD)
00011e  48bd              LDR      r0,|L4.1044|
000120  7800              LDRB     r0,[r0,#0]  ; TempTrackData
000122  28ff              CMP      r0,#0xff
000124  d1a6              BNE      |L4.116|
;;;799    					{
;;;800    						bcc = 0;	
000126  2500              MOVS     r5,#0
;;;801    						for(i = 0; i < SetKeyLen-1; i++)
000128  2400              MOVS     r4,#0
00012a  e004              B        |L4.310|
                  |L4.300|
;;;802    							bcc ^= SetKeyBuf[i];
00012c  48b9              LDR      r0,|L4.1044|
00012e  5d00              LDRB     r0,[r0,r4]
000130  4045              EORS     r5,r5,r0
000132  1c60              ADDS     r0,r4,#1              ;801
000134  b284              UXTH     r4,r0                 ;801
                  |L4.310|
000136  48b8              LDR      r0,|L4.1048|
000138  7800              LDRB     r0,[r0,#0]            ;801  ; SetKeyLen
00013a  1e40              SUBS     r0,r0,#1              ;801
00013c  42a0              CMP      r0,r4                 ;801
00013e  dcf5              BGT      |L4.300|
;;;803    						if (bcc == SetKeyBuf[SetKeyLen -1])			   	//校验
000140  48b5              LDR      r0,|L4.1048|
000142  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
000144  1e40              SUBS     r0,r0,#1
000146  49b3              LDR      r1,|L4.1044|
000148  5c08              LDRB     r0,[r1,r0]
00014a  42a8              CMP      r0,r5
00014c  d192              BNE      |L4.116|
;;;804    						{
;;;805    							SetKeyLen =  SetKeyBuf[2];					//拷贝密钥数据长度
00014e  4608              MOV      r0,r1
000150  7880              LDRB     r0,[r0,#2]  ; TempTrackData
000152  49b1              LDR      r1,|L4.1048|
000154  7008              STRB     r0,[r1,#0]
;;;806    							switch (SetKeyBuf[1])
000156  48af              LDR      r0,|L4.1044|
000158  7840              LDRB     r0,[r0,#1]  ; TempTrackData
00015a  280a              CMP      r0,#0xa
00015c  d01a              BEQ      |L4.404|
00015e  2813              CMP      r0,#0x13
000160  d166              BNE      |L4.560|
;;;807    							{
;;;808    								case SETKEYCOMMU:						//0x13	/* setting key communications commands */
;;;809    									if(0x01 == SetKeyLen && 0x02 == SetKeyBuf[3])
000162  4608              MOV      r0,r1
000164  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
000166  2801              CMP      r0,#1
000168  d10b              BNE      |L4.386|
00016a  48aa              LDR      r0,|L4.1044|
00016c  78c0              LDRB     r0,[r0,#3]  ; TempTrackData
00016e  2802              CMP      r0,#2
000170  d107              BNE      |L4.386|
;;;810    									{
;;;811    										send_frame(SETKEYCOMMU);
000172  2013              MOVS     r0,#0x13
000174  f7fffffe          BL       send_frame
;;;812    										SetKeyFlag = 1;
000178  2001              MOVS     r0,#1
00017a  49a3              LDR      r1,|L4.1032|
00017c  7008              STRB     r0,[r1,#0]
00017e  e006              B        |L4.398|
                  |L4.384|
000180  e24f              B        |L4.1570|
                  |L4.386|
;;;813    									}
;;;814    									else
;;;815    									{
;;;816    										send_frame(CMDERRO);
000182  2015              MOVS     r0,#0x15
000184  f7fffffe          BL       send_frame
;;;817    										SetKeyFlag = 0;
000188  2000              MOVS     r0,#0
00018a  499f              LDR      r1,|L4.1032|
00018c  7008              STRB     r0,[r1,#0]
                  |L4.398|
;;;818    									}
;;;819    									init_serial_boot();
00018e  f7fffffe          BL       init_serial_boot
;;;820    									break;
000192  e050              B        |L4.566|
                  |L4.404|
;;;821    								case SETKEYVALUE:						//0x0A	/* setting key value commands */
;;;822    									if(SetKeyFlag > 0)
000194  489c              LDR      r0,|L4.1032|
000196  7800              LDRB     r0,[r0,#0]  ; SetKeyFlag
000198  2800              CMP      r0,#0
00019a  dd43              BLE      |L4.548|
;;;823    									{
;;;824    										if(0x11 == SetKeyLen && 0x32==SetKeyBuf[3])			/* setting ksn value commands */
00019c  489e              LDR      r0,|L4.1048|
00019e  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
0001a0  2811              CMP      r0,#0x11
0001a2  d11b              BNE      |L4.476|
0001a4  489b              LDR      r0,|L4.1044|
0001a6  78c0              LDRB     r0,[r0,#3]  ; TempTrackData
0001a8  2832              CMP      r0,#0x32
0001aa  d117              BNE      |L4.476|
;;;825    										{
;;;826    											AsciiToHex(&SetKeyBuf[4],ENC_KEY.temp.ksn,SetKeyLen-1);
0001ac  489a              LDR      r0,|L4.1048|
0001ae  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
0001b0  1e42              SUBS     r2,r0,#1
0001b2  4996              LDR      r1,|L4.1036|
0001b4  3124              ADDS     r1,r1,#0x24
0001b6  4897              LDR      r0,|L4.1044|
0001b8  1d00              ADDS     r0,r0,#4
0001ba  f7fffffe          BL       AsciiToHex
;;;827    											if(GetNextKSN())
0001be  f7fffffe          BL       GetNextKSN
0001c2  b130              CBZ      r0,|L4.466|
;;;828    											{
;;;829    												send_frame(SETKEYVALUE);
0001c4  200a              MOVS     r0,#0xa
0001c6  f7fffffe          BL       send_frame
;;;830    												SetKeyFlag = 2;
0001ca  2002              MOVS     r0,#2
0001cc  498e              LDR      r1,|L4.1032|
0001ce  7008              STRB     r0,[r1,#0]
0001d0  e02b              B        |L4.554|
                  |L4.466|
;;;831    											}	
;;;832    											else
;;;833    												send_frame(CMDERRO);
0001d2  2015              MOVS     r0,#0x15
0001d4  f7fffffe          BL       send_frame
0001d8  e027              B        |L4.554|
                  |L4.474|
0001da  e02d              B        |L4.568|
                  |L4.476|
;;;834    											//WriteFlag = 0;
;;;835    										}
;;;836    										else if(0x21 == SetKeyLen && 0x33==SetKeyBuf[3])	   /* setting key value commands */
0001dc  488e              LDR      r0,|L4.1048|
0001de  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
0001e0  2821              CMP      r0,#0x21
0001e2  d122              BNE      |L4.554|
0001e4  488b              LDR      r0,|L4.1044|
0001e6  78c0              LDRB     r0,[r0,#3]  ; TempTrackData
0001e8  2833              CMP      r0,#0x33
0001ea  d11e              BNE      |L4.554|
;;;837    										{
;;;838    											AsciiToHex(&SetKeyBuf[4],ENC_KEY.temp.key,SetKeyLen-1);
0001ec  488a              LDR      r0,|L4.1048|
0001ee  7800              LDRB     r0,[r0,#0]  ; SetKeyLen
0001f0  1e42              SUBS     r2,r0,#1
0001f2  4986              LDR      r1,|L4.1036|
0001f4  3114              ADDS     r1,r1,#0x14
0001f6  4887              LDR      r0,|L4.1044|
0001f8  1d00              ADDS     r0,r0,#4
0001fa  f7fffffe          BL       AsciiToHex
;;;839    											ENC_KEY.temp.encmode = 0x31;
0001fe  2031              MOVS     r0,#0x31
000200  4982              LDR      r1,|L4.1036|
000202  7088              STRB     r0,[r1,#2]
;;;840    											ENC_KEY.temp.level = 0x33; 
000204  2033              MOVS     r0,#0x33
000206  7048              STRB     r0,[r1,#1]
;;;841    											WriteFlag = 1;
000208  2001              MOVS     r0,#1
00020a  4981              LDR      r1,|L4.1040|
00020c  7008              STRB     r0,[r1,#0]
;;;842    											WriteENCKEY();
00020e  f7fffffe          BL       WriteENCKEY
;;;843    											send_frame(SETKEYVALUE);
000212  200a              MOVS     r0,#0xa
000214  f7fffffe          BL       send_frame
;;;844    											SetKeyFlag = 0;
000218  2000              MOVS     r0,#0
00021a  497b              LDR      r1,|L4.1032|
00021c  7008              STRB     r0,[r1,#0]
;;;845    //											}	
;;;846    //											else
;;;847    //												send_frame(CMDERRO);
;;;848    											WriteFlag = 0;
00021e  497c              LDR      r1,|L4.1040|
000220  7008              STRB     r0,[r1,#0]
000222  e002              B        |L4.554|
                  |L4.548|
;;;849    										}										
;;;850    									}
;;;851    									else
;;;852    										send_frame(CMDERRO);
000224  2015              MOVS     r0,#0x15
000226  f7fffffe          BL       send_frame
                  |L4.554|
;;;853    									init_serial_boot();
00022a  f7fffffe          BL       init_serial_boot
;;;854    									break;
00022e  e002              B        |L4.566|
                  |L4.560|
;;;855    								default:
;;;856            	           				init_serial_boot();
000230  f7fffffe          BL       init_serial_boot
;;;857                	    				break; 
000234  bf00              NOP      
                  |L4.566|
000236  e1f6              B        |L4.1574|
                  |L4.568|
;;;858    							}
;;;859    						}
;;;860    					}
;;;861    					
;;;862    				}				
;;;863    				else if (READCMD == RxdBuf[1])					//0x52	/* read status commands */
000238  4871              LDR      r0,|L4.1024|
00023a  7840              LDRB     r0,[r0,#1]  ; TempTrackDirtData
00023c  2852              CMP      r0,#0x52
00023e  d140              BNE      |L4.706|
;;;864    				{
;;;865    					switch (RxdBuf[2])
000240  486f              LDR      r0,|L4.1024|
000242  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000244  2854              CMP      r0,#0x54
000246  d031              BEQ      |L4.684|
000248  dc06              BGT      |L4.600|
00024a  2822              CMP      r0,#0x22
00024c  d009              BEQ      |L4.610|
00024e  284e              CMP      r0,#0x4e
000250  d025              BEQ      |L4.670|
000252  2851              CMP      r0,#0x51
000254  d131              BNE      |L4.698|
000256  e01b              B        |L4.656|
                  |L4.600|
000258  2874              CMP      r0,#0x74
00025a  d009              BEQ      |L4.624|
00025c  287e              CMP      r0,#0x7e
00025e  d12c              BNE      |L4.698|
000260  e00f              B        |L4.642|
                  |L4.610|
;;;866    					{
;;;867    						case READID:						    //0x22	/* read secureheadreader ID */
;;;868    							send_frame(READID);
000262  2022              MOVS     r0,#0x22
000264  f7fffffe          BL       send_frame
;;;869    							RxdFrameStatus = SPACE;
000268  2000              MOVS     r0,#0
00026a  4964              LDR      r1,|L4.1020|
00026c  7008              STRB     r0,[r1,#0]
;;;870    	                		break;
00026e  e027              B        |L4.704|
                  |L4.624|
;;;871    						case GETCHALLENGE:						//0x74	/* get encrypt challenge */
;;;872    							Random();							//产生随机数
000270  f7fffffe          BL       Random
;;;873    							send_frame(GETCHALLENGE);
000274  2074              MOVS     r0,#0x74
000276  f7fffffe          BL       send_frame
;;;874    							RxdFrameStatus = SPACE;
00027a  2000              MOVS     r0,#0
00027c  495f              LDR      r1,|L4.1020|
00027e  7008              STRB     r0,[r1,#0]
;;;875    	                		break;
000280  e01e              B        |L4.704|
                  |L4.642|
;;;876    						case GETSECURITYLEVEL:					//0x7E	/* get security level */
;;;877    							send_frame(GETSECURITYLEVEL);
000282  207e              MOVS     r0,#0x7e
000284  f7fffffe          BL       send_frame
;;;878    							RxdFrameStatus = SPACE;
000288  2000              MOVS     r0,#0
00028a  495c              LDR      r1,|L4.1020|
00028c  7008              STRB     r0,[r1,#0]
;;;879    	                		break;
00028e  e017              B        |L4.704|
                  |L4.656|
;;;880    						case REVIEWKSN:							//0x51	/* review KSN (DUKPT key management only) */
;;;881    							send_frame(REVIEWKSN);
000290  2051              MOVS     r0,#0x51
000292  f7fffffe          BL       send_frame
;;;882    							RxdFrameStatus = SPACE;
000296  2000              MOVS     r0,#0
000298  4958              LDR      r1,|L4.1020|
00029a  7008              STRB     r0,[r1,#0]
;;;883    	                		break;
00029c  e010              B        |L4.704|
                  |L4.670|
;;;884    						case REVIEWSN:							//0x4E	/* review serial number */
;;;885    							send_frame(REVIEWSN);
00029e  204e              MOVS     r0,#0x4e
0002a0  f7fffffe          BL       send_frame
;;;886    							RxdFrameStatus = SPACE;
0002a4  2000              MOVS     r0,#0
0002a6  4955              LDR      r1,|L4.1020|
0002a8  7008              STRB     r0,[r1,#0]
;;;887    	                		break;
0002aa  e009              B        |L4.704|
                  |L4.684|
;;;888    						case SETSID:							//0x54	/* set Session ID */
;;;889    							send_frame(SETSID);
0002ac  2054              MOVS     r0,#0x54
0002ae  f7fffffe          BL       send_frame
;;;890    							RxdFrameStatus = SPACE;
0002b2  2000              MOVS     r0,#0
0002b4  4951              LDR      r1,|L4.1020|
0002b6  7008              STRB     r0,[r1,#0]
;;;891    	                		break;					
0002b8  e002              B        |L4.704|
                  |L4.698|
;;;892        	           		default:
;;;893            	           		init_serial_boot();
0002ba  f7fffffe          BL       init_serial_boot
;;;894                	    		break;
0002be  bf00              NOP      
                  |L4.704|
0002c0  e1b1              B        |L4.1574|
                  |L4.706|
;;;895                		}
;;;896    				}
;;;897    				else if (SETTINGCMD == RxdBuf[1])				//0x53	/* setting commands */
0002c2  484f              LDR      r0,|L4.1024|
0002c4  7840              LDRB     r0,[r0,#1]  ; TempTrackDirtData
0002c6  2853              CMP      r0,#0x53
0002c8  d174              BNE      |L4.948|
;;;898    				{
;;;899    					switch (RxdBuf[2])
0002ca  484d              LDR      r0,|L4.1024|
0002cc  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
0002ce  284e              CMP      r0,#0x4e
0002d0  d071              BEQ      |L4.950|
0002d2  dc10              BGT      |L4.758|
0002d4  2834              CMP      r0,#0x34
0002d6  d06f              BEQ      |L4.952|
0002d8  dc06              BGT      |L4.744|
0002da  2818              CMP      r0,#0x18
0002dc  d01a              BEQ      |L4.788|
0002de  281a              CMP      r0,#0x1a
0002e0  d06b              BEQ      |L4.954|
0002e2  281d              CMP      r0,#0x1d
                  |L4.740|
0002e4  d16a              BNE      |L4.956|
0002e6  e02d              B        |L4.836|
                  |L4.744|
0002e8  2835              CMP      r0,#0x35
0002ea  d068              BEQ      |L4.958|
0002ec  2836              CMP      r0,#0x36
0002ee  d067              BEQ      |L4.960|
0002f0  284c              CMP      r0,#0x4c
0002f2  d1f7              BNE      |L4.740|
0002f4  e0a4              B        |L4.1088|
                  |L4.758|
0002f6  2876              CMP      r0,#0x76
0002f8  d07d              BEQ      |L4.1014|
0002fa  dc06              BGT      |L4.778|
0002fc  2854              CMP      r0,#0x54
0002fe  d07b              BEQ      |L4.1016|
000300  2858              CMP      r0,#0x58
000302  d026              BEQ      |L4.850|
000304  2874              CMP      r0,#0x74
000306  d1ed              BNE      |L4.740|
000308  e05b              B        |L4.962|
                  |L4.778|
00030a  2884              CMP      r0,#0x84
00030c  d075              BEQ      |L4.1018|
00030e  2885              CMP      r0,#0x85
000310  d1e8              BNE      |L4.740|
000312  e0df              B        |L4.1236|
                  |L4.788|
;;;900    					{
;;;901    						case SETDEFAULT:						//0x18	/* set default configuration */
;;;902    							ENC_KEY.temp.status = 0;			//失能加密
000314  2000              MOVS     r0,#0
000316  493d              LDR      r1,|L4.1036|
000318  7008              STRB     r0,[r1,#0]
;;;903    							ENC_KEY.temp.level = 0x31;			//加密级别为1
00031a  2031              MOVS     r0,#0x31
00031c  7048              STRB     r0,[r1,#1]
;;;904    							ENC_KEY.temp.encway = 0x00;			//默认DES加密
00031e  2000              MOVS     r0,#0
000320  70c8              STRB     r0,[r1,#3]
;;;905    							macstate = 0x00;					//未接收到鉴定数据
000322  493e              LDR      r1,|L4.1052|
000324  7008              STRB     r0,[r1,#0]
;;;906    							WriteFlag = 1;
000326  2001              MOVS     r0,#1
000328  4939              LDR      r1,|L4.1040|
00032a  7008              STRB     r0,[r1,#0]
;;;907    							WriteENCKEY();						//保存更新后的KEY
00032c  f7fffffe          BL       WriteENCKEY
;;;908    							WriteFlag = 0;							
000330  2000              MOVS     r0,#0
000332  4937              LDR      r1,|L4.1040|
000334  7008              STRB     r0,[r1,#0]
;;;909    							send_frame(CMDSUCC);
000336  2006              MOVS     r0,#6
000338  f7fffffe          BL       send_frame
;;;910    							RxdFrameStatus = SPACE;
00033c  2000              MOVS     r0,#0
00033e  492f              LDR      r1,|L4.1020|
000340  7008              STRB     r0,[r1,#0]
;;;911    	                		break;
000342  e16a              B        |L4.1562|
                  |L4.836|
;;;912    						case SETDECODEWAY:						//0x1D	/* set decoding in both directions */							
;;;913    							send_frame(CMDSUCC);
000344  2006              MOVS     r0,#6
000346  f7fffffe          BL       send_frame
;;;914    							RxdFrameStatus = SPACE;
00034a  2000              MOVS     r0,#0
00034c  492b              LDR      r1,|L4.1020|
00034e  7008              STRB     r0,[r1,#0]
;;;915    	                		break;
000350  e163              B        |L4.1562|
                  |L4.850|
;;;916    						case SETENCMODE:						//0x58	/* set encryption mode */							
;;;917    							if(RxdBuf[3]==0x01)
000352  482b              LDR      r0,|L4.1024|
000354  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
000356  2801              CMP      r0,#1
000358  d125              BNE      |L4.934|
;;;918    							{	
;;;919    								if(0x30==RxdBuf[4]|| 0x31==RxdBuf[4])
00035a  4829              LDR      r0,|L4.1024|
00035c  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
00035e  2830              CMP      r0,#0x30
000360  d003              BEQ      |L4.874|
000362  4827              LDR      r0,|L4.1024|
000364  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
000366  2831              CMP      r0,#0x31
000368  d119              BNE      |L4.926|
                  |L4.874|
;;;920    								{
;;;921    									ENC_KEY.temp.encmode = RxdBuf[4];	//读取设置的加密方式
00036a  4825              LDR      r0,|L4.1024|
00036c  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
00036e  4927              LDR      r1,|L4.1036|
000370  7088              STRB     r0,[r1,#2]
;;;922    									if(0x30 == RxdBuf[4])
000372  4823              LDR      r0,|L4.1024|
000374  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
000376  2830              CMP      r0,#0x30
000378  d102              BNE      |L4.896|
;;;923    										ENC_KEY.temp.level = 0x32;
00037a  2032              MOVS     r0,#0x32
00037c  7048              STRB     r0,[r1,#1]
00037e  e002              B        |L4.902|
                  |L4.896|
;;;924    									else
;;;925    										ENC_KEY.temp.level = 0x33;	
000380  2033              MOVS     r0,#0x33
000382  4922              LDR      r1,|L4.1036|
000384  7048              STRB     r0,[r1,#1]
                  |L4.902|
;;;926    									WriteFlag = 1;
000386  2001              MOVS     r0,#1
000388  4921              LDR      r1,|L4.1040|
00038a  7008              STRB     r0,[r1,#0]
;;;927    									WriteENCKEY();				//保存更新后的KEY
00038c  f7fffffe          BL       WriteENCKEY
;;;928    									WriteFlag = 0;
000390  2000              MOVS     r0,#0
000392  491f              LDR      r1,|L4.1040|
000394  7008              STRB     r0,[r1,#0]
;;;929    									send_frame(CMDSUCC);
000396  2006              MOVS     r0,#6
000398  f7fffffe          BL       send_frame
00039c  e006              B        |L4.940|
                  |L4.926|
;;;930    								}
;;;931    								else
;;;932    									send_frame(CMDERRO);
00039e  2015              MOVS     r0,#0x15
0003a0  f7fffffe          BL       send_frame
0003a4  e002              B        |L4.940|
                  |L4.934|
;;;933    							}
;;;934    							else
;;;935    							{
;;;936    								send_frame(CMDERRO);
0003a6  2015              MOVS     r0,#0x15
0003a8  f7fffffe          BL       send_frame
                  |L4.940|
;;;937    							}
;;;938    							RxdFrameStatus = SPACE;
0003ac  2000              MOVS     r0,#0
0003ae  4913              LDR      r1,|L4.1020|
0003b0  7008              STRB     r0,[r1,#0]
;;;939    	                		break;
0003b2  e132              B        |L4.1562|
                  |L4.948|
0003b4  e132              B        |L4.1564|
                  |L4.950|
0003b6  e0f4              B        |L4.1442|
                  |L4.952|
0003b8  e09a              B        |L4.1264|
                  |L4.954|
0003ba  e110              B        |L4.1502|
                  |L4.956|
0003bc  e12a              B        |L4.1556|
                  |L4.958|
0003be  e09e              B        |L4.1278|
                  |L4.960|
0003c0  e0a4              B        |L4.1292|
                  |L4.962|
;;;940    						case SENDAUTHDATA:						//0x74	/* send authentication data */
;;;941    							//memcpy(random,"\x17\xCB\x4E\xCE\xC8\x64\xBB\x3C",8);		//debug
;;;942    							tri_des(random,ENC_KEY.temp.fix,ENC_KEY.temp.fix+8,0);
0003c2  2300              MOVS     r3,#0
0003c4  4a11              LDR      r2,|L4.1036|
0003c6  320c              ADDS     r2,r2,#0xc
0003c8  f1a20108          SUB      r1,r2,#8
0003cc  4814              LDR      r0,|L4.1056|
0003ce  f7fffffe          BL       tri_des
;;;943    							if(memcmp(random,&RxdBuf[4],RxdBuf[3]) == 0)
0003d2  480b              LDR      r0,|L4.1024|
0003d4  78c2              LDRB     r2,[r0,#3]  ; TempTrackDirtData
0003d6  1d01              ADDS     r1,r0,#4
0003d8  4811              LDR      r0,|L4.1056|
0003da  f7fffffe          BL       memcmp
0003de  bb08              CBNZ     r0,|L4.1060|
;;;944    							{
;;;945    								macstate = 0x31;				//鉴定数据OK
0003e0  2031              MOVS     r0,#0x31
0003e2  490e              LDR      r1,|L4.1052|
0003e4  7008              STRB     r0,[r1,#0]
;;;946    								memset(random,0x00,8);			//清空随机数
0003e6  480e              LDR      r0,|L4.1056|
0003e8  2100              MOVS     r1,#0
0003ea  6001              STR      r1,[r0,#0]  ; random
0003ec  6041              STR      r1,[r0,#4]  ; random
;;;947    								send_frame(CMDSUCC);	
0003ee  2006              MOVS     r0,#6
0003f0  f7fffffe          BL       send_frame
0003f4  e020              B        |L4.1080|
                  |L4.1014|
0003f6  e090              B        |L4.1306|
                  |L4.1016|
0003f8  e0b5              B        |L4.1382|
                  |L4.1018|
0003fa  e058              B        |L4.1198|
                  |L4.1020|
                          DCD      RxdFrameStatus
                  |L4.1024|
                          DCD      TempTrackDirtData
                  |L4.1028|
                          DCD      RxdTotalLen
                  |L4.1032|
                          DCD      SetKeyFlag
                  |L4.1036|
                          DCD      ENC_KEY
                  |L4.1040|
                          DCD      WriteFlag
                  |L4.1044|
                          DCD      TempTrackData
                  |L4.1048|
                          DCD      SetKeyLen
                  |L4.1052|
                          DCD      macstate
                  |L4.1056|
                          DCD      random
                  |L4.1060|
;;;948    							}
;;;949    							else
;;;950    							{
;;;951    								macstate = 0x30;				//鉴定数据失败
000424  2030              MOVS     r0,#0x30
000426  4980              LDR      r1,|L4.1576|
000428  7008              STRB     r0,[r1,#0]
;;;952    								memset(random,0x00,8);			//清空随机数
00042a  4880              LDR      r0,|L4.1580|
00042c  2100              MOVS     r1,#0
00042e  6001              STR      r1,[r0,#0]  ; random
000430  6041              STR      r1,[r0,#4]  ; random
;;;953    								send_frame(CMDERRO);	
000432  2015              MOVS     r0,#0x15
000434  f7fffffe          BL       send_frame
                  |L4.1080|
;;;954    							}
;;;955    							RxdFrameStatus = SPACE;
000438  2000              MOVS     r0,#0
00043a  497d              LDR      r1,|L4.1584|
00043c  7008              STRB     r0,[r1,#0]
;;;956    	                		break;
00043e  e0ec              B        |L4.1562|
                  |L4.1088|
;;;957    						case SETENCWAY:							//0x4C	/* set encryption way */
;;;958    							if(RxdBuf[3]==0x01)
000440  487c              LDR      r0,|L4.1588|
000442  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
000444  2801              CMP      r0,#1
000446  d120              BNE      |L4.1162|
;;;959    							{	
;;;960    								if(0x30 == RxdBuf[4] || 0x31 == RxdBuf[4] || 0x32 == RxdBuf[4])
000448  487a              LDR      r0,|L4.1588|
00044a  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
00044c  2830              CMP      r0,#0x30
00044e  d007              BEQ      |L4.1120|
000450  4878              LDR      r0,|L4.1588|
000452  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
000454  2831              CMP      r0,#0x31
000456  d003              BEQ      |L4.1120|
000458  4876              LDR      r0,|L4.1588|
00045a  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
00045c  2832              CMP      r0,#0x32
00045e  d110              BNE      |L4.1154|
                  |L4.1120|
;;;961    								{
;;;962    									ENC_KEY.temp.encway = RxdBuf[4];//读取设置的加密类型
000460  4874              LDR      r0,|L4.1588|
000462  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
000464  4974              LDR      r1,|L4.1592|
000466  70c8              STRB     r0,[r1,#3]
;;;963    									ENC_KEY.temp.status = 1;	//使能加密
000468  2001              MOVS     r0,#1
00046a  7008              STRB     r0,[r1,#0]
;;;964    									WriteFlag = 1;
00046c  4973              LDR      r1,|L4.1596|
00046e  7008              STRB     r0,[r1,#0]
;;;965    									WriteENCKEY();				//保存更新后的KEY
000470  f7fffffe          BL       WriteENCKEY
;;;966    									WriteFlag = 0;
000474  2000              MOVS     r0,#0
000476  4971              LDR      r1,|L4.1596|
000478  7008              STRB     r0,[r1,#0]
;;;967    									send_frame(CMDSUCC);
00047a  2006              MOVS     r0,#6
00047c  f7fffffe          BL       send_frame
000480  e011              B        |L4.1190|
                  |L4.1154|
;;;968    								}
;;;969    								else
;;;970    									send_frame(CMDERRO);
000482  2015              MOVS     r0,#0x15
000484  f7fffffe          BL       send_frame
000488  e00d              B        |L4.1190|
                  |L4.1162|
;;;971    							}
;;;972    							else
;;;973    							{
;;;974    								ENC_KEY.temp.status = 0;		//失能加密
00048a  2000              MOVS     r0,#0
00048c  496a              LDR      r1,|L4.1592|
00048e  7008              STRB     r0,[r1,#0]
;;;975    								WriteFlag = 1;
000490  2001              MOVS     r0,#1
000492  496a              LDR      r1,|L4.1596|
000494  7008              STRB     r0,[r1,#0]
;;;976    								WriteENCKEY();					//保存更新后的KEY
000496  f7fffffe          BL       WriteENCKEY
;;;977    								WriteFlag = 0;
00049a  2000              MOVS     r0,#0
00049c  4967              LDR      r1,|L4.1596|
00049e  7008              STRB     r0,[r1,#0]
;;;978    								send_frame(CMDERRO);
0004a0  2015              MOVS     r0,#0x15
0004a2  f7fffffe          BL       send_frame
                  |L4.1190|
;;;979    							}
;;;980    							RxdFrameStatus = SPACE;
0004a6  2000              MOVS     r0,#0
0004a8  4961              LDR      r1,|L4.1584|
0004aa  7008              STRB     r0,[r1,#0]
;;;981    	                		break;
0004ac  e0b5              B        |L4.1562|
                  |L4.1198|
;;;982    						case SETTHREETRACKS:					//0x84	/* set all three tracks */
;;;983    							if(RxdBuf[3]==0x01)
0004ae  4861              LDR      r0,|L4.1588|
0004b0  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
0004b2  2801              CMP      r0,#1
0004b4  d107              BNE      |L4.1222|
;;;984    							{	
;;;985    								if(0x0F == RxdBuf[4])		    //匹配命令的参数
0004b6  485f              LDR      r0,|L4.1588|
0004b8  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
0004ba  280f              CMP      r0,#0xf
0004bc  d106              BNE      |L4.1228|
;;;986    								{
;;;987    									send_frame(CMDSUCC);
0004be  2006              MOVS     r0,#6
0004c0  f7fffffe          BL       send_frame
0004c4  e002              B        |L4.1228|
                  |L4.1222|
;;;988    								}
;;;989    							}
;;;990    							else
;;;991    							{
;;;992    								send_frame(CMDERRO);
0004c6  2015              MOVS     r0,#0x15
0004c8  f7fffffe          BL       send_frame
                  |L4.1228|
;;;993    							}
;;;994    							RxdFrameStatus = SPACE;
0004cc  2000              MOVS     r0,#0
0004ce  4958              LDR      r1,|L4.1584|
0004d0  7008              STRB     r0,[r1,#0]
;;;995    	                		break;
0004d2  e0a2              B        |L4.1562|
                  |L4.1236|
;;;996    						case ASKTHREETRACKS:					 //0x85	/* ask all three tracks */
;;;997    							if(RxdBuf[3])
0004d4  4857              LDR      r0,|L4.1588|
0004d6  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
0004d8  b118              CBZ      r0,|L4.1250|
;;;998    							{	
;;;999    								if(0x31 == RxdBuf[4]);			 //匹配命令的参数
;;;1000   									send_frame(CMDSUCC);
0004da  2006              MOVS     r0,#6
0004dc  f7fffffe          BL       send_frame
0004e0  e002              B        |L4.1256|
                  |L4.1250|
;;;1001   							}
;;;1002   							else
;;;1003   							{
;;;1004   								send_frame(CMDERRO);
0004e2  2015              MOVS     r0,#0x15
0004e4  f7fffffe          BL       send_frame
                  |L4.1256|
;;;1005   							}
;;;1006   							RxdFrameStatus = SPACE;
0004e8  2000              MOVS     r0,#0
0004ea  4951              LDR      r1,|L4.1584|
0004ec  7008              STRB     r0,[r1,#0]
;;;1007   	                		break;
0004ee  e094              B        |L4.1562|
                  |L4.1264|
;;;1008   						case SETDEFWAY1:						//0x34	/* set default way 1 */
;;;1009   							send_frame(CMDSUCC);
0004f0  2006              MOVS     r0,#6
0004f2  f7fffffe          BL       send_frame
;;;1010   							RxdFrameStatus = SPACE;
0004f6  2000              MOVS     r0,#0
0004f8  494d              LDR      r1,|L4.1584|
0004fa  7008              STRB     r0,[r1,#0]
;;;1011   	                		break;
0004fc  e08d              B        |L4.1562|
                  |L4.1278|
;;;1012   						case SETDEFWAY2:						//0x35	/* set default way 2 */
;;;1013   							send_frame(CMDSUCC);
0004fe  2006              MOVS     r0,#6
000500  f7fffffe          BL       send_frame
;;;1014   							RxdFrameStatus = SPACE;
000504  2000              MOVS     r0,#0
000506  494a              LDR      r1,|L4.1584|
000508  7008              STRB     r0,[r1,#0]
;;;1015   	                		break;
00050a  e086              B        |L4.1562|
                  |L4.1292|
;;;1016   						case SETDEFWAY3:						//0x36	/* set default way 3 */
;;;1017   							send_frame(CMDSUCC);
00050c  2006              MOVS     r0,#6
00050e  f7fffffe          BL       send_frame
;;;1018   							RxdFrameStatus = SPACE;
000512  2000              MOVS     r0,#0
000514  4946              LDR      r1,|L4.1584|
000516  7008              STRB     r0,[r1,#0]
;;;1019   	                		break;
000518  e07f              B        |L4.1562|
                  |L4.1306|
;;;1020   						case SETDEVICEKEY:						//0x76	/* set device key command */
;;;1021   							if(RxdBuf[3]==0x10 && 0x31 == macstate)
00051a  4846              LDR      r0,|L4.1588|
00051c  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
00051e  2810              CMP      r0,#0x10
000520  d11a              BNE      |L4.1368|
000522  4841              LDR      r0,|L4.1576|
000524  7800              LDRB     r0,[r0,#0]  ; macstate
000526  2831              CMP      r0,#0x31
000528  d116              BNE      |L4.1368|
;;;1022   							{
;;;1023   								memcpy(ENC_KEY.temp.fix,&RxdBuf[4],10);
00052a  4843              LDR      r0,|L4.1592|
00052c  4941              LDR      r1,|L4.1588|
00052e  684a              LDR      r2,[r1,#4]  ; TempTrackDirtData
000530  6042              STR      r2,[r0,#4]  ; ENC_KEY
000532  688a              LDR      r2,[r1,#8]  ; TempTrackDirtData
000534  6082              STR      r2,[r0,#8]  ; ENC_KEY
000536  8989              LDRH     r1,[r1,#0xc]  ; TempTrackDirtData
000538  8181              STRH     r1,[r0,#0xc]
;;;1024   								ENC_KEY.temp.level = 0x32;
00053a  2032              MOVS     r0,#0x32
00053c  493e              LDR      r1,|L4.1592|
00053e  7048              STRB     r0,[r1,#1]
;;;1025   								WriteFlag = 1;
000540  2001              MOVS     r0,#1
000542  493e              LDR      r1,|L4.1596|
000544  7008              STRB     r0,[r1,#0]
;;;1026   								WriteENCKEY();					//保存更新后的KEY
000546  f7fffffe          BL       WriteENCKEY
;;;1027   								WriteFlag = 0; 								
00054a  2000              MOVS     r0,#0
00054c  493b              LDR      r1,|L4.1596|
00054e  7008              STRB     r0,[r1,#0]
;;;1028   								send_frame(CMDSUCC);
000550  2006              MOVS     r0,#6
000552  f7fffffe          BL       send_frame
000556  e002              B        |L4.1374|
                  |L4.1368|
;;;1029   							}
;;;1030   							else
;;;1031   								send_frame(CMDERRO);	
000558  2015              MOVS     r0,#0x15
00055a  f7fffffe          BL       send_frame
                  |L4.1374|
;;;1032   							RxdFrameStatus = SPACE;
00055e  2000              MOVS     r0,#0
000560  4933              LDR      r1,|L4.1584|
000562  7008              STRB     r0,[r1,#0]
;;;1033   	                		break;
000564  e059              B        |L4.1562|
                  |L4.1382|
;;;1034   						case SETSID:							//0x54	/* set Session ID */
;;;1035   							if(RxdBuf[3]==0x08)
000566  4833              LDR      r0,|L4.1588|
000568  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
00056a  2808              CMP      r0,#8
00056c  d112              BNE      |L4.1428|
;;;1036   							{
;;;1037   								memcpy(ENC_KEY.temp.sid,&RxdBuf[4],8);
00056e  4832              LDR      r0,|L4.1592|
000570  302e              ADDS     r0,r0,#0x2e
000572  4930              LDR      r1,|L4.1588|
000574  684a              LDR      r2,[r1,#4]  ; TempTrackDirtData
000576  6002              STR      r2,[r0,#0]  ; ENC_KEY
000578  6889              LDR      r1,[r1,#8]  ; TempTrackDirtData
00057a  6041              STR      r1,[r0,#4]  ; ENC_KEY
;;;1038   								WriteFlag = 1;
00057c  2001              MOVS     r0,#1
00057e  492f              LDR      r1,|L4.1596|
000580  7008              STRB     r0,[r1,#0]
;;;1039   								WriteENCKEY();					//保存会话ID
000582  f7fffffe          BL       WriteENCKEY
;;;1040   								WriteFlag = 0; 								
000586  2000              MOVS     r0,#0
000588  492c              LDR      r1,|L4.1596|
00058a  7008              STRB     r0,[r1,#0]
;;;1041   								send_frame(CMDSUCC);
00058c  2006              MOVS     r0,#6
00058e  f7fffffe          BL       send_frame
000592  e002              B        |L4.1434|
                  |L4.1428|
;;;1042   							}
;;;1043   							else
;;;1044   								send_frame(CMDERRO);	
000594  2015              MOVS     r0,#0x15
000596  f7fffffe          BL       send_frame
                  |L4.1434|
;;;1045   							RxdFrameStatus = SPACE;
00059a  2000              MOVS     r0,#0
00059c  4924              LDR      r1,|L4.1584|
00059e  7008              STRB     r0,[r1,#0]
;;;1046   	                		break;
0005a0  e03b              B        |L4.1562|
                  |L4.1442|
;;;1047   						case REVIEWSN:							//0x4E	/* review serial number */
;;;1048   							if(RxdBuf[3]==0x08)
0005a2  4824              LDR      r0,|L4.1588|
0005a4  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
0005a6  2808              CMP      r0,#8
0005a8  d112              BNE      |L4.1488|
;;;1049   							{
;;;1050   								memcpy(ENC_KEY.temp.sn,&RxdBuf[4],8);
0005aa  4823              LDR      r0,|L4.1592|
0005ac  3036              ADDS     r0,r0,#0x36
0005ae  4921              LDR      r1,|L4.1588|
0005b0  684a              LDR      r2,[r1,#4]  ; TempTrackDirtData
0005b2  6002              STR      r2,[r0,#0]  ; ENC_KEY
0005b4  6889              LDR      r1,[r1,#8]  ; TempTrackDirtData
0005b6  6041              STR      r1,[r0,#4]  ; ENC_KEY
;;;1051   								WriteFlag = 1;
0005b8  2001              MOVS     r0,#1
0005ba  4920              LDR      r1,|L4.1596|
0005bc  7008              STRB     r0,[r1,#0]
;;;1052   								WriteENCKEY();					//保存序列号
0005be  f7fffffe          BL       WriteENCKEY
;;;1053   								WriteFlag = 0; 								
0005c2  2000              MOVS     r0,#0
0005c4  491d              LDR      r1,|L4.1596|
0005c6  7008              STRB     r0,[r1,#0]
;;;1054   								send_frame(CMDSUCC);
0005c8  2006              MOVS     r0,#6
0005ca  f7fffffe          BL       send_frame
0005ce  e002              B        |L4.1494|
                  |L4.1488|
;;;1055   							}
;;;1056   							else
;;;1057   								send_frame(CMDERRO);	
0005d0  2015              MOVS     r0,#0x15
0005d2  f7fffffe          BL       send_frame
                  |L4.1494|
;;;1058   							RxdFrameStatus = SPACE;
0005d6  2000              MOVS     r0,#0
0005d8  4915              LDR      r1,|L4.1584|
0005da  7008              STRB     r0,[r1,#0]
;;;1059   	                		break;
0005dc  e01d              B        |L4.1562|
                  |L4.1502|
;;;1060   						case MSRSETTINGS:						//0x1A	/* MSR Reading Settings */							
;;;1061   							if(RxdBuf[3]==0x01)
0005de  4815              LDR      r0,|L4.1588|
0005e0  78c0              LDRB     r0,[r0,#3]  ; TempTrackDirtData
0005e2  2801              CMP      r0,#1
0005e4  d10f              BNE      |L4.1542|
;;;1062   							{
;;;1063   								ENC_KEY.temp.level = RxdBuf[4];
0005e6  4813              LDR      r0,|L4.1588|
0005e8  7900              LDRB     r0,[r0,#4]  ; TempTrackDirtData
0005ea  4913              LDR      r1,|L4.1592|
0005ec  7048              STRB     r0,[r1,#1]
;;;1064   								WriteFlag = 1;
0005ee  2001              MOVS     r0,#1
0005f0  4912              LDR      r1,|L4.1596|
0005f2  7008              STRB     r0,[r1,#0]
;;;1065   								WriteENCKEY();					
0005f4  f7fffffe          BL       WriteENCKEY
;;;1066   								WriteFlag = 0; 								
0005f8  2000              MOVS     r0,#0
0005fa  4910              LDR      r1,|L4.1596|
0005fc  7008              STRB     r0,[r1,#0]
;;;1067   								send_frame(CMDSUCC);
0005fe  2006              MOVS     r0,#6
000600  f7fffffe          BL       send_frame
000604  e002              B        |L4.1548|
                  |L4.1542|
;;;1068   							}
;;;1069   							else
;;;1070   								send_frame(CMDERRO);	
000606  2015              MOVS     r0,#0x15
000608  f7fffffe          BL       send_frame
                  |L4.1548|
;;;1071   							RxdFrameStatus = SPACE;
00060c  2000              MOVS     r0,#0
00060e  4908              LDR      r1,|L4.1584|
000610  7008              STRB     r0,[r1,#0]
;;;1072   			            break;
000612  e002              B        |L4.1562|
                  |L4.1556|
;;;1073   		    	        default:
;;;1074   		        	       init_serial_boot();
000614  f7fffffe          BL       init_serial_boot
;;;1075   		            	break;
000618  bf00              NOP      
                  |L4.1562|
00061a  e004              B        |L4.1574|
                  |L4.1564|
;;;1076   		            }
;;;1077   				}
;;;1078   				else
;;;1079   				{
;;;1080   					init_serial_boot();
00061c  f7fffffe          BL       init_serial_boot
000620  e001              B        |L4.1574|
                  |L4.1570|
;;;1081   				}	
;;;1082   			}	
;;;1083   		}
;;;1084   		else
;;;1085   		{
;;;1086   			init_serial_boot();
000622  f7fffffe          BL       init_serial_boot
                  |L4.1574|
;;;1087   		}
;;;1088   	}
;;;1089   //	else
;;;1090   //	{
;;;1091   //		init_serial_boot();
;;;1092   //	}
;;;1093   }
000626  bd70              POP      {r4-r6,pc}
;;;1094   
                          ENDP

                  |L4.1576|
                          DCD      macstate
                  |L4.1580|
                          DCD      random
                  |L4.1584|
                          DCD      RxdFrameStatus
                  |L4.1588|
                          DCD      TempTrackDirtData
                  |L4.1592|
                          DCD      ENC_KEY
                  |L4.1596|
                          DCD      WriteFlag

                          AREA ||i.DealSerialParse||, CODE, READONLY, ALIGN=2

                  DealSerialParse PROC
;;;584    ***************************************************************************************/
;;;585    void DealSerialParse(void)
000000  b538              PUSH     {r3-r5,lr}
;;;586    {
;;;587    	uint8_t i,len;
;;;588    	while(1)
000002  e15c              B        |L5.702|
                  |L5.4|
;;;589    	{
;;;590    		len = dev_com_read(&i, 1);   //读取SPI数据
000004  2101              MOVS     r1,#1
000006  4668              MOV      r0,sp
000008  f7fffffe          BL       dev_com_read
00000c  b2c4              UXTB     r4,r0
;;;591    		
;;;592    		if(len <= 0) 
00000e  2c00              CMP      r4,#0
000010  dc00              BGT      |L5.20|
;;;593    			return;
;;;594    		
;;;595    		switch (RxdStatus)
;;;596    		{ /*接收数据状态*/
;;;597    			case 0:
;;;598    				RxdFrameStatus = SPACE;
;;;599    				if (SOH == i) 
;;;600    				{
;;;601    					SynHead++;
;;;602    					if (SynHead == HEAD_NUM) 
;;;603    					{
;;;604    						RxdBuf[0] = i;
;;;605    						Bcc = i;
;;;606    						NowLen = 1;
;;;607    						RxdStatus = 20;
;;;608    					}
;;;609    				 }
;;;610    				 else if(STX == i)
;;;611    				 {
;;;612    					RxdBuf[0] = i;
;;;613    					Bcc = i;
;;;614    					NowLen = 1;
;;;615    					RxdStatus = 25;
;;;616    				 }
;;;617    				 else 
;;;618    				 {
;;;619    					SynHead = 0;
;;;620    				 }
;;;621    				 break;				/*接收包头*/
;;;622    			
;;;623    			case 20:
;;;624    				if (ORDER == i) 
;;;625    				{ 
;;;626    					RxdBuf[NowLen++] = i;
;;;627    					Bcc +=i;
;;;628    					RxdStatus = 23;
;;;629    					RxdTotalLen = 3;
;;;630    				}
;;;631    				else 
;;;632    				{
;;;633    					if (TEXT == i) 
;;;634    					{
;;;635    						RxdBuf[NowLen++] = i;
;;;636    						Bcc +=i;
;;;637    						RxdStatus = 21;
;;;638    					}
;;;639    					else 
;;;640    					{
;;;641    						if (i != SOH) 
;;;642    						{
;;;643    							RxdStatus = 0;
;;;644    							SynHead = 0;
;;;645    						}
;;;646    					}
;;;647    				} 
;;;648    				break;
;;;649    			case 21:
;;;650    				RxdBuf[NowLen++] = i; // 帧标识
;;;651    				Bcc += i;
;;;652    				RxdStatus = 22;
;;;653    				break;
;;;654    			case 22:
;;;655    				RxdBuf[NowLen++] = i;
;;;656    				Bcc += i;
;;;657    				RxdTotalLen = i + 5;
;;;658    				if (RxdTotalLen > 250) 
;;;659    				{
;;;660    					RxdTotalLen = 250;
;;;661    				}
;;;662    				RxdStatus = 23;
;;;663    				break;
;;;664    			case 23:
;;;665    				RxdBuf[NowLen++] = i;
;;;666    				Bcc += i;
;;;667    				if (NowLen == RxdTotalLen) 
;;;668    				{
;;;669    					RxdStatus = 24;
;;;670    				}
;;;671    				break;
;;;672    			case 24:
;;;673    				if(i == Bcc)
;;;674    				{
;;;675    					RxdBuf[NowLen++] = i;
;;;676    					RxdTotalLen = NowLen;
;;;677    					RxdFrameStatus = FINISH;					
;;;678    					RxdStatus = 0;
;;;679    					SynHead = 0;
;;;680    					break;
;;;681    				}
;;;682    				else
;;;683    				{
;;;684    					RxdStatus = 0;
;;;685    					SynHead = 0;
;;;686    				}
;;;687    				break;
;;;688    			case 25:
;;;689    				if (i == ETX) 
;;;690    				{
;;;691    					RxdStatus = 26;
;;;692    				}
;;;693    				RxdBuf[NowLen++] = i;
;;;694    				Bcc ^= i;
;;;695    				break;
;;;696    			case 26:
;;;697    				if(i == Bcc || (i ^ 0x02) == Bcc)
;;;698    				{
;;;699    					RxdBuf[NowLen++] = i;
;;;700    					RxdTotalLen = NowLen;
;;;701    					RxdFrameStatus = FINISH;					
;;;702    					RxdStatus = 0;
;;;703    					SynHead = 0;
;;;704    					break;
;;;705    				}
;;;706    				else
;;;707    				{
;;;708    					RxdBuf[NowLen++] = i;
;;;709    					Bcc ^= i;
;;;710    					RxdStatus = 25;
;;;711    				}
;;;712    				break;
;;;713    			default:
;;;714    				if (RxdFrameStatus == SPACE) 
;;;715    				{
;;;716    					RxdStatus = 0;
;;;717    					SynHead = 0;
;;;718    				}
;;;719    			break;
;;;720    		 }
;;;721    	}
;;;722    }
000012  bd38              POP      {r3-r5,pc}
                  |L5.20|
000014  48aa              LDR      r0,|L5.704|
000016  7800              LDRB     r0,[r0,#0]            ;595  ; RxdStatus
000018  2817              CMP      r0,#0x17              ;595
00001a  d078              BEQ      |L5.270|
00001c  dc07              BGT      |L5.46|
00001e  b168              CBZ      r0,|L5.60|
000020  2814              CMP      r0,#0x14              ;595
000022  d041              BEQ      |L5.168|
000024  2815              CMP      r0,#0x15              ;595
000026  d073              BEQ      |L5.272|
000028  2816              CMP      r0,#0x16              ;595
                  |L5.42|
00002a  d172              BNE      |L5.274|
00002c  e092              B        |L5.340|
                  |L5.46|
00002e  2818              CMP      r0,#0x18              ;595
000030  d070              BEQ      |L5.276|
000032  2819              CMP      r0,#0x19              ;595
000034  d06f              BEQ      |L5.278|
000036  281a              CMP      r0,#0x1a              ;595
000038  d1f7              BNE      |L5.42|
00003a  e0fe              B        |L5.570|
                  |L5.60|
00003c  2000              MOVS     r0,#0                 ;598
00003e  49a1              LDR      r1,|L5.708|
000040  7008              STRB     r0,[r1,#0]            ;598
000042  f89d0000          LDRB     r0,[sp,#0]            ;599
000046  2801              CMP      r0,#1                 ;599
000048  d117              BNE      |L5.122|
00004a  489f              LDR      r0,|L5.712|
00004c  7800              LDRB     r0,[r0,#0]            ;601  ; SynHead
00004e  1c40              ADDS     r0,r0,#1              ;601
000050  499d              LDR      r1,|L5.712|
000052  7008              STRB     r0,[r1,#0]            ;601
000054  4608              MOV      r0,r1                 ;602
000056  7800              LDRB     r0,[r0,#0]            ;602  ; SynHead
000058  2803              CMP      r0,#3                 ;602
00005a  d124              BNE      |L5.166|
00005c  f89d0000          LDRB     r0,[sp,#0]            ;604
000060  499a              LDR      r1,|L5.716|
000062  7008              STRB     r0,[r1,#0]            ;604
000064  f89d0000          LDRB     r0,[sp,#0]            ;605
000068  4999              LDR      r1,|L5.720|
00006a  7008              STRB     r0,[r1,#0]            ;605
00006c  2001              MOVS     r0,#1                 ;606
00006e  4999              LDR      r1,|L5.724|
000070  7008              STRB     r0,[r1,#0]            ;606
000072  2014              MOVS     r0,#0x14              ;607
000074  4992              LDR      r1,|L5.704|
000076  7008              STRB     r0,[r1,#0]            ;607
000078  e015              B        |L5.166|
                  |L5.122|
00007a  f89d0000          LDRB     r0,[sp,#0]            ;610
00007e  2802              CMP      r0,#2                 ;610
000080  d10e              BNE      |L5.160|
000082  f89d0000          LDRB     r0,[sp,#0]            ;612
000086  4991              LDR      r1,|L5.716|
000088  7008              STRB     r0,[r1,#0]            ;612
00008a  f89d0000          LDRB     r0,[sp,#0]            ;613
00008e  4990              LDR      r1,|L5.720|
000090  7008              STRB     r0,[r1,#0]            ;613
000092  2001              MOVS     r0,#1                 ;614
000094  498f              LDR      r1,|L5.724|
000096  7008              STRB     r0,[r1,#0]            ;614
000098  2019              MOVS     r0,#0x19              ;615
00009a  4989              LDR      r1,|L5.704|
00009c  7008              STRB     r0,[r1,#0]            ;615
00009e  e002              B        |L5.166|
                  |L5.160|
0000a0  2000              MOVS     r0,#0                 ;619
0000a2  4989              LDR      r1,|L5.712|
0000a4  7008              STRB     r0,[r1,#0]            ;619
                  |L5.166|
0000a6  e109              B        |L5.700|
                  |L5.168|
0000a8  f89d0000          LDRB     r0,[sp,#0]            ;624
0000ac  2813              CMP      r0,#0x13              ;624
0000ae  d116              BNE      |L5.222|
0000b0  f89d2000          LDRB     r2,[sp,#0]            ;626
0000b4  4987              LDR      r1,|L5.724|
0000b6  7808              LDRB     r0,[r1,#0]            ;626  ; NowLen
0000b8  1c41              ADDS     r1,r0,#1              ;626
0000ba  4b86              LDR      r3,|L5.724|
0000bc  7019              STRB     r1,[r3,#0]            ;626
0000be  4983              LDR      r1,|L5.716|
0000c0  540a              STRB     r2,[r1,r0]            ;626
0000c2  4883              LDR      r0,|L5.720|
0000c4  7800              LDRB     r0,[r0,#0]            ;627  ; Bcc
0000c6  f89d1000          LDRB     r1,[sp,#0]            ;627
0000ca  4408              ADD      r0,r0,r1              ;627
0000cc  4980              LDR      r1,|L5.720|
0000ce  7008              STRB     r0,[r1,#0]            ;627
0000d0  2017              MOVS     r0,#0x17              ;628
0000d2  497b              LDR      r1,|L5.704|
0000d4  7008              STRB     r0,[r1,#0]            ;628
0000d6  2003              MOVS     r0,#3                 ;629
0000d8  497f              LDR      r1,|L5.728|
0000da  7008              STRB     r0,[r1,#0]            ;629
0000dc  e025              B        |L5.298|
                  |L5.222|
0000de  f89d0000          LDRB     r0,[sp,#0]            ;633
0000e2  2812              CMP      r0,#0x12              ;633
0000e4  d118              BNE      |L5.280|
0000e6  f89d2000          LDRB     r2,[sp,#0]            ;635
0000ea  497a              LDR      r1,|L5.724|
0000ec  7808              LDRB     r0,[r1,#0]            ;635  ; NowLen
0000ee  1c41              ADDS     r1,r0,#1              ;635
0000f0  4b78              LDR      r3,|L5.724|
0000f2  7019              STRB     r1,[r3,#0]            ;635
0000f4  4975              LDR      r1,|L5.716|
0000f6  540a              STRB     r2,[r1,r0]            ;635
0000f8  4875              LDR      r0,|L5.720|
0000fa  7800              LDRB     r0,[r0,#0]            ;636  ; Bcc
0000fc  f89d1000          LDRB     r1,[sp,#0]            ;636
000100  4408              ADD      r0,r0,r1              ;636
000102  4973              LDR      r1,|L5.720|
000104  7008              STRB     r0,[r1,#0]            ;636
000106  2015              MOVS     r0,#0x15              ;637
000108  496d              LDR      r1,|L5.704|
00010a  7008              STRB     r0,[r1,#0]            ;637
00010c  e00d              B        |L5.298|
                  |L5.270|
00010e  e040              B        |L5.402|
                  |L5.272|
000110  e00c              B        |L5.300|
                  |L5.274|
000112  e0ca              B        |L5.682|
                  |L5.276|
000114  e057              B        |L5.454|
                  |L5.278|
000116  e078              B        |L5.522|
                  |L5.280|
000118  f89d0000          LDRB     r0,[sp,#0]            ;641
00011c  2801              CMP      r0,#1                 ;641
00011e  d004              BEQ      |L5.298|
000120  2000              MOVS     r0,#0                 ;643
000122  4967              LDR      r1,|L5.704|
000124  7008              STRB     r0,[r1,#0]            ;643
000126  4968              LDR      r1,|L5.712|
000128  7008              STRB     r0,[r1,#0]            ;644
                  |L5.298|
00012a  e0c7              B        |L5.700|
                  |L5.300|
00012c  f89d2000          LDRB     r2,[sp,#0]            ;650
000130  4968              LDR      r1,|L5.724|
000132  7808              LDRB     r0,[r1,#0]            ;650  ; NowLen
000134  1c41              ADDS     r1,r0,#1              ;650
000136  4b67              LDR      r3,|L5.724|
000138  7019              STRB     r1,[r3,#0]            ;650
00013a  4964              LDR      r1,|L5.716|
00013c  540a              STRB     r2,[r1,r0]            ;650
00013e  4864              LDR      r0,|L5.720|
000140  7800              LDRB     r0,[r0,#0]            ;651  ; Bcc
000142  f89d1000          LDRB     r1,[sp,#0]            ;651
000146  4408              ADD      r0,r0,r1              ;651
000148  4961              LDR      r1,|L5.720|
00014a  7008              STRB     r0,[r1,#0]            ;651
00014c  2016              MOVS     r0,#0x16              ;652
00014e  495c              LDR      r1,|L5.704|
000150  7008              STRB     r0,[r1,#0]            ;652
000152  e0b3              B        |L5.700|
                  |L5.340|
000154  f89d2000          LDRB     r2,[sp,#0]            ;655
000158  495e              LDR      r1,|L5.724|
00015a  7808              LDRB     r0,[r1,#0]            ;655  ; NowLen
00015c  1c41              ADDS     r1,r0,#1              ;655
00015e  4b5d              LDR      r3,|L5.724|
000160  7019              STRB     r1,[r3,#0]            ;655
000162  495a              LDR      r1,|L5.716|
000164  540a              STRB     r2,[r1,r0]            ;655
000166  485a              LDR      r0,|L5.720|
000168  7800              LDRB     r0,[r0,#0]            ;656  ; Bcc
00016a  f89d1000          LDRB     r1,[sp,#0]            ;656
00016e  4408              ADD      r0,r0,r1              ;656
000170  4957              LDR      r1,|L5.720|
000172  7008              STRB     r0,[r1,#0]            ;656
000174  f89d0000          LDRB     r0,[sp,#0]            ;657
000178  1d40              ADDS     r0,r0,#5              ;657
00017a  4957              LDR      r1,|L5.728|
00017c  7008              STRB     r0,[r1,#0]            ;657
00017e  4608              MOV      r0,r1                 ;658
000180  7800              LDRB     r0,[r0,#0]            ;658  ; RxdTotalLen
000182  28fa              CMP      r0,#0xfa              ;658
000184  dd01              BLE      |L5.394|
000186  20fa              MOVS     r0,#0xfa              ;660
000188  7008              STRB     r0,[r1,#0]            ;660
                  |L5.394|
00018a  2017              MOVS     r0,#0x17              ;662
00018c  494c              LDR      r1,|L5.704|
00018e  7008              STRB     r0,[r1,#0]            ;662
000190  e094              B        |L5.700|
                  |L5.402|
000192  f89d2000          LDRB     r2,[sp,#0]            ;665
000196  494f              LDR      r1,|L5.724|
000198  7808              LDRB     r0,[r1,#0]            ;665  ; NowLen
00019a  1c41              ADDS     r1,r0,#1              ;665
00019c  4b4d              LDR      r3,|L5.724|
00019e  7019              STRB     r1,[r3,#0]            ;665
0001a0  494a              LDR      r1,|L5.716|
0001a2  540a              STRB     r2,[r1,r0]            ;665
0001a4  484a              LDR      r0,|L5.720|
0001a6  7800              LDRB     r0,[r0,#0]            ;666  ; Bcc
0001a8  f89d1000          LDRB     r1,[sp,#0]            ;666
0001ac  4408              ADD      r0,r0,r1              ;666
0001ae  4948              LDR      r1,|L5.720|
0001b0  7008              STRB     r0,[r1,#0]            ;666
0001b2  4618              MOV      r0,r3                 ;667
0001b4  7800              LDRB     r0,[r0,#0]            ;667  ; NowLen
0001b6  4948              LDR      r1,|L5.728|
0001b8  7809              LDRB     r1,[r1,#0]            ;667  ; RxdTotalLen
0001ba  4288              CMP      r0,r1                 ;667
0001bc  d102              BNE      |L5.452|
0001be  2018              MOVS     r0,#0x18              ;669
0001c0  493f              LDR      r1,|L5.704|
0001c2  7008              STRB     r0,[r1,#0]            ;669
                  |L5.452|
0001c4  e07a              B        |L5.700|
                  |L5.454|
0001c6  f89d0000          LDRB     r0,[sp,#0]            ;673
0001ca  4941              LDR      r1,|L5.720|
0001cc  7809              LDRB     r1,[r1,#0]            ;673  ; Bcc
0001ce  4288              CMP      r0,r1                 ;673
0001d0  d115              BNE      |L5.510|
0001d2  f89d2000          LDRB     r2,[sp,#0]            ;675
0001d6  493f              LDR      r1,|L5.724|
0001d8  7808              LDRB     r0,[r1,#0]            ;675  ; NowLen
0001da  1c41              ADDS     r1,r0,#1              ;675
0001dc  4b3d              LDR      r3,|L5.724|
0001de  7019              STRB     r1,[r3,#0]            ;675
0001e0  493a              LDR      r1,|L5.716|
0001e2  540a              STRB     r2,[r1,r0]            ;675
0001e4  4618              MOV      r0,r3                 ;676
0001e6  7800              LDRB     r0,[r0,#0]            ;676  ; NowLen
0001e8  493b              LDR      r1,|L5.728|
0001ea  7008              STRB     r0,[r1,#0]            ;676
0001ec  2055              MOVS     r0,#0x55              ;677
0001ee  4935              LDR      r1,|L5.708|
0001f0  7008              STRB     r0,[r1,#0]            ;677
0001f2  2000              MOVS     r0,#0                 ;678
0001f4  4932              LDR      r1,|L5.704|
0001f6  7008              STRB     r0,[r1,#0]            ;678
0001f8  4933              LDR      r1,|L5.712|
0001fa  7008              STRB     r0,[r1,#0]            ;679
0001fc  e05e              B        |L5.700|
                  |L5.510|
0001fe  2000              MOVS     r0,#0                 ;684
000200  492f              LDR      r1,|L5.704|
000202  7008              STRB     r0,[r1,#0]            ;684
000204  4930              LDR      r1,|L5.712|
000206  7008              STRB     r0,[r1,#0]            ;685
000208  e058              B        |L5.700|
                  |L5.522|
00020a  f89d0000          LDRB     r0,[sp,#0]            ;689
00020e  2803              CMP      r0,#3                 ;689
000210  d102              BNE      |L5.536|
000212  201a              MOVS     r0,#0x1a              ;691
000214  492a              LDR      r1,|L5.704|
000216  7008              STRB     r0,[r1,#0]            ;691
                  |L5.536|
000218  f89d2000          LDRB     r2,[sp,#0]            ;693
00021c  492d              LDR      r1,|L5.724|
00021e  7808              LDRB     r0,[r1,#0]            ;693  ; NowLen
000220  1c41              ADDS     r1,r0,#1              ;693
000222  4b2c              LDR      r3,|L5.724|
000224  7019              STRB     r1,[r3,#0]            ;693
000226  4929              LDR      r1,|L5.716|
000228  540a              STRB     r2,[r1,r0]            ;693
00022a  4829              LDR      r0,|L5.720|
00022c  7800              LDRB     r0,[r0,#0]            ;694  ; Bcc
00022e  f89d1000          LDRB     r1,[sp,#0]            ;694
000232  4048              EORS     r0,r0,r1              ;694
000234  4926              LDR      r1,|L5.720|
000236  7008              STRB     r0,[r1,#0]            ;694
000238  e040              B        |L5.700|
                  |L5.570|
00023a  f89d0000          LDRB     r0,[sp,#0]            ;697
00023e  4924              LDR      r1,|L5.720|
000240  7809              LDRB     r1,[r1,#0]            ;697  ; Bcc
000242  4288              CMP      r0,r1                 ;697
000244  d007              BEQ      |L5.598|
000246  f89d0000          LDRB     r0,[sp,#0]            ;697
00024a  f0800002          EOR      r0,r0,#2              ;697
00024e  4920              LDR      r1,|L5.720|
000250  7809              LDRB     r1,[r1,#0]            ;697  ; Bcc
000252  4288              CMP      r0,r1                 ;697
000254  d115              BNE      |L5.642|
                  |L5.598|
000256  f89d2000          LDRB     r2,[sp,#0]            ;699
00025a  491e              LDR      r1,|L5.724|
00025c  7808              LDRB     r0,[r1,#0]            ;699  ; NowLen
00025e  1c41              ADDS     r1,r0,#1              ;699
000260  4b1c              LDR      r3,|L5.724|
000262  7019              STRB     r1,[r3,#0]            ;699
000264  4919              LDR      r1,|L5.716|
000266  540a              STRB     r2,[r1,r0]            ;699
000268  4618              MOV      r0,r3                 ;700
00026a  7800              LDRB     r0,[r0,#0]            ;700  ; NowLen
00026c  491a              LDR      r1,|L5.728|
00026e  7008              STRB     r0,[r1,#0]            ;700
000270  2055              MOVS     r0,#0x55              ;701
000272  4914              LDR      r1,|L5.708|
000274  7008              STRB     r0,[r1,#0]            ;701
000276  2000              MOVS     r0,#0                 ;702
000278  4911              LDR      r1,|L5.704|
00027a  7008              STRB     r0,[r1,#0]            ;702
00027c  4912              LDR      r1,|L5.712|
00027e  7008              STRB     r0,[r1,#0]            ;703
000280  e01c              B        |L5.700|
                  |L5.642|
000282  f89d2000          LDRB     r2,[sp,#0]            ;708
000286  4913              LDR      r1,|L5.724|
000288  7808              LDRB     r0,[r1,#0]            ;708  ; NowLen
00028a  1c41              ADDS     r1,r0,#1              ;708
00028c  4b11              LDR      r3,|L5.724|
00028e  7019              STRB     r1,[r3,#0]            ;708
000290  490e              LDR      r1,|L5.716|
000292  540a              STRB     r2,[r1,r0]            ;708
000294  480e              LDR      r0,|L5.720|
000296  7800              LDRB     r0,[r0,#0]            ;709  ; Bcc
000298  f89d1000          LDRB     r1,[sp,#0]            ;709
00029c  4048              EORS     r0,r0,r1              ;709
00029e  490c              LDR      r1,|L5.720|
0002a0  7008              STRB     r0,[r1,#0]            ;709
0002a2  2019              MOVS     r0,#0x19              ;710
0002a4  4906              LDR      r1,|L5.704|
0002a6  7008              STRB     r0,[r1,#0]            ;710
0002a8  e008              B        |L5.700|
                  |L5.682|
0002aa  4806              LDR      r0,|L5.708|
0002ac  7800              LDRB     r0,[r0,#0]            ;714  ; RxdFrameStatus
0002ae  b920              CBNZ     r0,|L5.698|
0002b0  2000              MOVS     r0,#0                 ;716
0002b2  4903              LDR      r1,|L5.704|
0002b4  7008              STRB     r0,[r1,#0]            ;716
0002b6  4904              LDR      r1,|L5.712|
0002b8  7008              STRB     r0,[r1,#0]            ;717
                  |L5.698|
0002ba  bf00              NOP                            ;719
                  |L5.700|
0002bc  bf00              NOP                            ;621
                  |L5.702|
0002be  e6a1              B        |L5.4|
;;;723    
                          ENDP

                  |L5.704|
                          DCD      RxdStatus
                  |L5.708|
                          DCD      RxdFrameStatus
                  |L5.712|
                          DCD      SynHead
                  |L5.716|
                          DCD      TempTrackDirtData
                  |L5.720|
                          DCD      Bcc
                  |L5.724|
                          DCD      NowLen
                  |L5.728|
                          DCD      RxdTotalLen

                          AREA ||i.GetNextKSN||, CODE, READONLY, ALIGN=2

                  GetNextKSN PROC
;;;274    ***************************************************************************************/
;;;275    uint8_t GetNextKSN(void)
000000  b510              PUSH     {r4,lr}
;;;276    {
;;;277    	(*(ENC_KEY.temp.ksn + 9))++;
000002  4822              LDR      r0,|L6.140|
000004  f890002d          LDRB     r0,[r0,#0x2d]
000008  1c40              ADDS     r0,r0,#1
00000a  b2c1              UXTB     r1,r0
00000c  481f              LDR      r0,|L6.140|
00000e  f880102d          STRB     r1,[r0,#0x2d]
;;;278    	if(	*(ENC_KEY.temp.ksn + 9) == 0x00)
000012  f890002d          LDRB     r0,[r0,#0x2d]
000016  bb70              CBNZ     r0,|L6.118|
;;;279    	{
;;;280    		(*(ENC_KEY.temp.ksn + 8))++;
000018  481c              LDR      r0,|L6.140|
00001a  f890002c          LDRB     r0,[r0,#0x2c]
00001e  1c40              ADDS     r0,r0,#1
000020  b2c1              UXTB     r1,r0
000022  481a              LDR      r0,|L6.140|
000024  f880102c          STRB     r1,[r0,#0x2c]
;;;281    		if(	*(ENC_KEY.temp.ksn + 8) == 0x00)
000028  f890002c          LDRB     r0,[r0,#0x2c]
00002c  bb18              CBNZ     r0,|L6.118|
;;;282    		{
;;;283    			(*(ENC_KEY.temp.ksn + 7))++;
00002e  4817              LDR      r0,|L6.140|
000030  f890002b          LDRB     r0,[r0,#0x2b]
000034  1c40              ADDS     r0,r0,#1
000036  b2c1              UXTB     r1,r0
000038  4814              LDR      r0,|L6.140|
00003a  f880102b          STRB     r1,[r0,#0x2b]
;;;284    			if(	(*(ENC_KEY.temp.ksn + 7)) == 0x00)
00003e  f890002b          LDRB     r0,[r0,#0x2b]
000042  b9c0              CBNZ     r0,|L6.118|
;;;285    			{
;;;286    				(*(ENC_KEY.temp.ksn + 6))++;
000044  4811              LDR      r0,|L6.140|
000046  f890002a          LDRB     r0,[r0,#0x2a]
00004a  1c40              ADDS     r0,r0,#1
00004c  b2c1              UXTB     r1,r0
00004e  480f              LDR      r0,|L6.140|
000050  f880102a          STRB     r1,[r0,#0x2a]
;;;287    				if(	*(ENC_KEY.temp.ksn + 6) == 0x00)
000054  f890002a          LDRB     r0,[r0,#0x2a]
000058  b968              CBNZ     r0,|L6.118|
;;;288    				{
;;;289    					(*(ENC_KEY.temp.ksn + 5))++;
00005a  480c              LDR      r0,|L6.140|
00005c  f8900029          LDRB     r0,[r0,#0x29]
000060  1c40              ADDS     r0,r0,#1
000062  b2c1              UXTB     r1,r0
000064  4809              LDR      r0,|L6.140|
000066  f8801029          STRB     r1,[r0,#0x29]
;;;290    					if(	*(ENC_KEY.temp.ksn + 5) >= 0xFF)
00006a  f8900029          LDRB     r0,[r0,#0x29]
00006e  28ff              CMP      r0,#0xff
000070  db02              BLT      |L6.120|
;;;291    					{
;;;292    						return FALSE;
000072  2000              MOVS     r0,#0
                  |L6.116|
;;;293    					}
;;;294    				}
;;;295    			}
;;;296    		}
;;;297    	}
;;;298    	WriteFlag = 1;
;;;299    	WriteENCKEY();							  //保存更新后的KSN
;;;300    //	{
;;;301    //		WriteFlag = 0;
;;;302    //		return TRUE;
;;;303    //	}
;;;304    	WriteFlag = 0;
;;;305    	return TRUE;
;;;306    }
000074  bd10              POP      {r4,pc}
                  |L6.118|
000076  e7ff              B        |L6.120|
                  |L6.120|
000078  2001              MOVS     r0,#1                 ;298
00007a  4905              LDR      r1,|L6.144|
00007c  7008              STRB     r0,[r1,#0]            ;298
00007e  f7fffffe          BL       WriteENCKEY
000082  2000              MOVS     r0,#0                 ;304
000084  4902              LDR      r1,|L6.144|
000086  7008              STRB     r0,[r1,#0]            ;304
000088  2001              MOVS     r0,#1                 ;305
00008a  e7f3              B        |L6.116|
;;;307    
                          ENDP

                  |L6.140|
                          DCD      ENC_KEY
                  |L6.144|
                          DCD      WriteFlag

                          AREA ||i.HexToAscii||, CODE, READONLY, ALIGN=1

                  HexToAscii PROC
;;;227    ***************************************************************************************/
;;;228    void HexToAscii(uint8_t *pHex, uint8_t *pASSCHex, int nLen)
000000  b578              PUSH     {r3-r6,lr}
;;;229    {
000002  4603              MOV      r3,r0
000004  460c              MOV      r4,r1
;;;230    	uint8_t Nibble[2];
;;;231    	int i,j;
;;;232    	for ( i = 0; i < nLen; i ++)
000006  2100              MOVS     r1,#0
000008  e027              B        |L7.90|
                  |L7.10|
;;;233    	{
;;;234    		Nibble[0] = (pHex[i] & 0xF0) >> 4;	
00000a  5c5d              LDRB     r5,[r3,r1]
00000c  092d              LSRS     r5,r5,#4
00000e  f88d5000          STRB     r5,[sp,#0]
;;;235    		Nibble[1] = pHex[i] & 0x0F;
000012  5c5d              LDRB     r5,[r3,r1]
000014  f005050f          AND      r5,r5,#0xf
000018  f88d5001          STRB     r5,[sp,#1]
;;;236    		for ( j = 0; j < 2; j ++)
00001c  2000              MOVS     r0,#0
00001e  e019              B        |L7.84|
                  |L7.32|
;;;237    		{
;;;238    			if (Nibble[j] < 10)
000020  f81d5000          LDRB     r5,[sp,r0]
000024  2d0a              CMP      r5,#0xa
000026  da06              BGE      |L7.54|
;;;239    				Nibble[j] += 0x30;
000028  f81d5000          LDRB     r5,[sp,r0]
00002c  3530              ADDS     r5,r5,#0x30
00002e  b2ed              UXTB     r5,r5
000030  f80d5000          STRB     r5,[sp,r0]
000034  e009              B        |L7.74|
                  |L7.54|
;;;240    			else
;;;241    			{
;;;242    				if (Nibble[j] < 16)
000036  f81d5000          LDRB     r5,[sp,r0]
00003a  2d10              CMP      r5,#0x10
00003c  da05              BGE      |L7.74|
;;;243    					Nibble[j] = Nibble[j] - 10 + 'A';
00003e  f81d5000          LDRB     r5,[sp,r0]
000042  3537              ADDS     r5,r5,#0x37
000044  b2ed              UXTB     r5,r5
000046  f80d5000          STRB     r5,[sp,r0]
                  |L7.74|
;;;244    			}
;;;245    			*pASSCHex ++ = Nibble[j];
00004a  f81d5000          LDRB     r5,[sp,r0]
00004e  f8045b01          STRB     r5,[r4],#1
000052  1c40              ADDS     r0,r0,#1              ;236
                  |L7.84|
000054  2802              CMP      r0,#2                 ;236
000056  dbe3              BLT      |L7.32|
000058  1c49              ADDS     r1,r1,#1              ;232
                  |L7.90|
00005a  4291              CMP      r1,r2                 ;232
00005c  dbd5              BLT      |L7.10|
;;;246    		}	// for (int j = ...)
;;;247    	}	// for (int i = ...)
;;;248    }
00005e  bd78              POP      {r3-r6,pc}
;;;249    
                          ENDP


                          AREA ||i.NVIC_Clear_all||, CODE, READONLY, ALIGN=2

                  NVIC_Clear_all PROC
;;;44     //关闭所有中断
;;;45     void NVIC_Clear_all(void)
000000  2000              MOVS     r0,#0
;;;46     {
;;;47     	uint32_t i;
;;;48     	for(i=0; i<3; i++)
000002  e004              B        |L8.14|
                  |L8.4|
;;;49     		NVIC->ICER[i] = 0;
000004  2200              MOVS     r2,#0
000006  4908              LDR      r1,|L8.40|
000008  f8412020          STR      r2,[r1,r0,LSL #2]
00000c  1c40              ADDS     r0,r0,#1              ;48
                  |L8.14|
00000e  2803              CMP      r0,#3                 ;48
000010  d3f8              BCC      |L8.4|
;;;50     	for(i=0; i<3; i++)
000012  2000              MOVS     r0,#0
000014  e004              B        |L8.32|
                  |L8.22|
;;;51     		NVIC->ICPR[i] = 0;
000016  2200              MOVS     r2,#0
000018  4904              LDR      r1,|L8.44|
00001a  f8412020          STR      r2,[r1,r0,LSL #2]
00001e  1c40              ADDS     r0,r0,#1              ;50
                  |L8.32|
000020  2803              CMP      r0,#3                 ;50
000022  d3f8              BCC      |L8.22|
;;;52     }
000024  4770              BX       lr
;;;53     
                          ENDP

000026  0000              DCW      0x0000
                  |L8.40|
                          DCD      0xe000e180
                  |L8.44|
                          DCD      0xe000e280

                          AREA ||i.Random||, CODE, READONLY, ALIGN=2

                  Random PROC
;;;257    ***************************************************************************************/
;;;258    void Random(void) 
000000  b510              PUSH     {r4,lr}
;;;259    {
;;;260    	uint8_t i;
;;;261    	for(i = 0; i < 8; i++)
000002  2400              MOVS     r4,#0
000004  e00a              B        |L9.28|
                  |L9.6|
;;;262    	{
;;;263    		random[i] = rand() % 255;
000006  f7fffffe          BL       rand
00000a  21ff              MOVS     r1,#0xff
00000c  fb90f2f1          SDIV     r2,r0,r1
000010  fb010012          MLS      r0,r1,r2,r0
000014  4903              LDR      r1,|L9.36|
000016  5508              STRB     r0,[r1,r4]
000018  1c60              ADDS     r0,r4,#1              ;261
00001a  b2c4              UXTB     r4,r0                 ;261
                  |L9.28|
00001c  2c08              CMP      r4,#8                 ;261
00001e  dbf2              BLT      |L9.6|
;;;264    	}
;;;265    }
000020  bd10              POP      {r4,pc}
;;;266    
                          ENDP

000022  0000              DCW      0x0000
                  |L9.36|
                          DCD      random

                          AREA ||i.ReadENCKEY||, CODE, READONLY, ALIGN=2

                  ReadENCKEY PROC
;;;156    ***************************************************************************************/
;;;157    uint8_t ReadENCKEY(void)
000000  b570              PUSH     {r4-r6,lr}
;;;158    {
000002  b090              SUB      sp,sp,#0x40
;;;159    	#ifdef FLASHKEY_SUPPORT
;;;160    	uint8_t tempdata[64],i,lrc,bcc;
;;;161    	memset(tempdata ,0, 64);
000004  2140              MOVS     r1,#0x40
000006  4668              MOV      r0,sp
000008  f7fffffe          BL       __aeabi_memclr4
;;;162    	ReadBlockFlash(KEYADD ,tempdata, 64);     			//读出之前保存的密钥值
00000c  2240              MOVS     r2,#0x40
00000e  4669              MOV      r1,sp
000010  481a              LDR      r0,|L10.124|
000012  f7fffffe          BL       ReadBlockFlash
;;;163    	for(i=0;i<8;i++)
000016  2400              MOVS     r4,#0
000018  e00a              B        |L10.48|
                  |L10.26|
;;;164    		tri_des(tempdata+i*8,(unsigned char *)SHID,(unsigned char *)SHID+8,1);	   //解密存储的密钥值
00001a  4669              MOV      r1,sp
00001c  eb0100c4          ADD      r0,r1,r4,LSL #3
000020  2301              MOVS     r3,#1
000022  4a17              LDR      r2,|L10.128|
000024  f1a20108          SUB      r1,r2,#8
000028  f7fffffe          BL       tri_des
00002c  1c60              ADDS     r0,r4,#1              ;163
00002e  b2c4              UXTB     r4,r0                 ;163
                  |L10.48|
000030  2c08              CMP      r4,#8                 ;163
000032  dbf2              BLT      |L10.26|
;;;165    	memcpy(ENC_KEY.key,tempdata,64);
000034  2240              MOVS     r2,#0x40
000036  4669              MOV      r1,sp
000038  4812              LDR      r0,|L10.132|
00003a  f7fffffe          BL       __aeabi_memcpy
;;;166    	//校验保存的密钥
;;;167    	for(lrc=bcc=i=0;i<62;i++)
00003e  2500              MOVS     r5,#0
000040  462c              MOV      r4,r5
000042  462e              MOV      r6,r5
000044  e008              B        |L10.88|
                  |L10.70|
;;;168    	{
;;;169    		lrc ^= tempdata[i];
000046  f81d0004          LDRB     r0,[sp,r4]
00004a  4045              EORS     r5,r5,r0
;;;170    		bcc += tempdata[i];
00004c  f81d0004          LDRB     r0,[sp,r4]
000050  4430              ADD      r0,r0,r6
000052  b2c6              UXTB     r6,r0
000054  1c60              ADDS     r0,r4,#1              ;167
000056  b2c4              UXTB     r4,r0                 ;167
                  |L10.88|
000058  2c3e              CMP      r4,#0x3e              ;167
00005a  dbf4              BLT      |L10.70|
;;;171    	}
;;;172    	if(lrc == ENC_KEY.key[62] && bcc == ENC_KEY.key[63] )
00005c  4809              LDR      r0,|L10.132|
00005e  f890003e          LDRB     r0,[r0,#0x3e]  ; ENC_KEY
000062  42a8              CMP      r0,r5
000064  d107              BNE      |L10.118|
000066  4807              LDR      r0,|L10.132|
000068  f890003f          LDRB     r0,[r0,#0x3f]  ; ENC_KEY
00006c  42b0              CMP      r0,r6
00006e  d102              BNE      |L10.118|
;;;173    		return TRUE;
000070  2001              MOVS     r0,#1
                  |L10.114|
;;;174    	else
;;;175    		return FALSE;
;;;176    	#else
;;;177    	return TRUE;
;;;178    	#endif
;;;179    }
000072  b010              ADD      sp,sp,#0x40
000074  bd70              POP      {r4-r6,pc}
                  |L10.118|
000076  2000              MOVS     r0,#0                 ;175
000078  e7fb              B        |L10.114|
;;;180    
                          ENDP

00007a  0000              DCW      0x0000
                  |L10.124|
                          DCD      0x0800e000
                  |L10.128|
                          DCD      SHID+0x8
                  |L10.132|
                          DCD      ENC_KEY

                          AREA ||i.WriteENCKEY||, CODE, READONLY, ALIGN=2

                  WriteENCKEY PROC
;;;117    ***************************************************************************************/
;;;118    void WriteENCKEY(void)
000000  b510              PUSH     {r4,lr}
;;;119    {
000002  b090              SUB      sp,sp,#0x40
;;;120    	#ifdef FLASHKEY_SUPPORT
;;;121    	uint8_t i;
;;;122    	uint8_t tempdata[64];
;;;123    	memset(tempdata ,0, 64);
000004  2140              MOVS     r1,#0x40
000006  4668              MOV      r0,sp
000008  f7fffffe          BL       __aeabi_memclr4
;;;124    	if(WriteFlag==1)
00000c  481f              LDR      r0,|L11.140|
00000e  7800              LDRB     r0,[r0,#0]  ; WriteFlag
000010  2801              CMP      r0,#1
000012  d138              BNE      |L11.134|
;;;125    	{
;;;126    		memcpy(tempdata,ENC_KEY.key,62);
000014  223e              MOVS     r2,#0x3e
000016  491e              LDR      r1,|L11.144|
000018  4668              MOV      r0,sp
00001a  f7fffffe          BL       __aeabi_memcpy
;;;127    		memcpy(tempdata+62,"\x00\x00",2);
00001e  a01d              ADR      r0,|L11.148|
000020  8800              LDRH     r0,[r0,#0]
000022  f8ad003e          STRH     r0,[sp,#0x3e]
;;;128    		for(i=0;i<62;i++)
000026  2400              MOVS     r4,#0
000028  e010              B        |L11.76|
                  |L11.42|
;;;129    		{
;;;130    			tempdata[62] ^= tempdata[i];
00002a  f89d003e          LDRB     r0,[sp,#0x3e]
00002e  f81d1004          LDRB     r1,[sp,r4]
000032  4048              EORS     r0,r0,r1
000034  f88d003e          STRB     r0,[sp,#0x3e]
;;;131    			tempdata[63] += tempdata[i];
000038  f89d003f          LDRB     r0,[sp,#0x3f]
00003c  f81d1004          LDRB     r1,[sp,r4]
000040  4408              ADD      r0,r0,r1
000042  b2c0              UXTB     r0,r0
000044  f88d003f          STRB     r0,[sp,#0x3f]
000048  1c60              ADDS     r0,r4,#1              ;128
00004a  b2c4              UXTB     r4,r0                 ;128
                  |L11.76|
00004c  2c3e              CMP      r4,#0x3e              ;128
00004e  dbec              BLT      |L11.42|
;;;132    		}
;;;133     		for(i=0;i<8;i++)
000050  2400              MOVS     r4,#0
000052  e00a              B        |L11.106|
                  |L11.84|
;;;134     			tri_des(tempdata+i*8,(unsigned char *)SHID,(unsigned char *)SHID+8,0);	   //加密要存储的密钥值
000054  4669              MOV      r1,sp
000056  eb0100c4          ADD      r0,r1,r4,LSL #3
00005a  2300              MOVS     r3,#0
00005c  4a0e              LDR      r2,|L11.152|
00005e  f1a20108          SUB      r1,r2,#8
000062  f7fffffe          BL       tri_des
000066  1c60              ADDS     r0,r4,#1              ;133
000068  b2c4              UXTB     r4,r0                 ;133
                  |L11.106|
00006a  2c08              CMP      r4,#8                 ;133
00006c  dbf2              BLT      |L11.84|
;;;135    		__disable_irq();
00006e  b672              CPSID    i
;;;136    		EarseBlockFlash(KEYADD);
000070  480a              LDR      r0,|L11.156|
000072  f7fffffe          BL       EarseBlockFlash
;;;137    		WriteBlockFlash(KEYADD ,tempdata, 64);
000076  2240              MOVS     r2,#0x40
000078  4669              MOV      r1,sp
00007a  4808              LDR      r0,|L11.156|
00007c  f7fffffe          BL       WriteBlockFlash
;;;138    		__enable_irq();
000080  b662              CPSIE    i
                  |L11.130|
;;;139    		return ;
;;;140    	}
;;;141    	else
;;;142    	{
;;;143    		return ;
;;;144    	}
;;;145    	#endif
;;;146    	
;;;147    }
000082  b010              ADD      sp,sp,#0x40
000084  bd10              POP      {r4,pc}
                  |L11.134|
000086  bf00              NOP                            ;143
000088  e7fb              B        |L11.130|
;;;148    
                          ENDP

00008a  0000              DCW      0x0000
                  |L11.140|
                          DCD      WriteFlag
                  |L11.144|
                          DCD      ENC_KEY
                  |L11.148|
000094  00                DCB      0
000095  00                DCB      0
000096  00                DCB      0
000097  00                DCB      0
                  |L11.152|
                          DCD      SHID+0x8
                  |L11.156|
                          DCD      0x0800e000

                          AREA ||i.init_serial_boot||, CODE, READONLY, ALIGN=2

                  init_serial_boot PROC
;;;101    
;;;102    void init_serial_boot(void)
000000  2000              MOVS     r0,#0
;;;103    {
;;;104    	RxdStatus = 0;
000002  4903              LDR      r1,|L12.16|
000004  7008              STRB     r0,[r1,#0]
;;;105    	SynHead = 0;
000006  4903              LDR      r1,|L12.20|
000008  7008              STRB     r0,[r1,#0]
;;;106    	RxdFrameStatus = SPACE;
00000a  4903              LDR      r1,|L12.24|
00000c  7008              STRB     r0,[r1,#0]
;;;107    }
00000e  4770              BX       lr
;;;108    
                          ENDP

                  |L12.16|
                          DCD      RxdStatus
                  |L12.20|
                          DCD      SynHead
                  |L12.24|
                          DCD      RxdFrameStatus

                          AREA ||i.send_frame||, CODE, READONLY, ALIGN=2

                  send_frame PROC
;;;338    ***************************************************************************************/
;;;339    void send_frame(uint8_t frame_type)
000000  b5f0              PUSH     {r4-r7,lr}
;;;340    {
000002  b0a3              SUB      sp,sp,#0x8c
000004  4607              MOV      r7,r0
;;;341        uint8_t i, j, bcc;
;;;342    	uint8_t TxdBuf[MAX_TXD_BUF_LEN];
;;;343    	uint8_t TempBuf[20];
;;;344    	uint8_t pBKCV[6];
;;;345    	uint8_t bpSEncod[10]={0xFF,0x00,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
000006  a2fc              ADR      r2,|L13.1016|
000008  e9d21000          LDRD     r1,r0,[r2,#0]
00000c  6892              LDR      r2,[r2,#8]
00000e  e9cd0201          STRD     r0,r2,[sp,#4]
000012  9100              STR      r1,[sp,#0]
;;;346        for (i = 0; i < 5; i++) 
000014  2400              MOVS     r4,#0
000016  e004              B        |L13.34|
                  |L13.24|
;;;347    	{
;;;348            TxdBuf[i] = SOH;    
000018  2001              MOVS     r0,#1
00001a  a90a              ADD      r1,sp,#0x28
00001c  5508              STRB     r0,[r1,r4]
00001e  1c60              ADDS     r0,r4,#1              ;346
000020  b2c4              UXTB     r4,r0                 ;346
                  |L13.34|
000022  2c05              CMP      r4,#5                 ;346
000024  dbf8              BLT      |L13.24|
;;;349        }
;;;350        
;;;351        bcc = SOH;
000026  2501              MOVS     r5,#1
;;;352        
;;;353        switch (frame_type) 
000028  2f51              CMP      r7,#0x51
00002a  d074              BEQ      |L13.278|
00002c  dc0e              BGT      |L13.76|
00002e  2f15              CMP      r7,#0x15
000030  d079              BEQ      |L13.294|
000032  dc06              BGT      |L13.66|
000034  2f06              CMP      r7,#6
000036  d075              BEQ      |L13.292|
000038  2f0a              CMP      r7,#0xa
00003a  d06f              BEQ      |L13.284|
00003c  2f13              CMP      r7,#0x13
                  |L13.62|
00003e  d16e              BNE      |L13.286|
000040  e209              B        |L13.1110|
                  |L13.66|
000042  2f22              CMP      r7,#0x22
000044  d06c              BEQ      |L13.288|
000046  2f4e              CMP      r7,#0x4e
000048  d1f9              BNE      |L13.62|
00004a  e161              B        |L13.784|
                  |L13.76|
00004c  2f7e              CMP      r7,#0x7e
00004e  d070              BEQ      |L13.306|
000050  dc04              BGT      |L13.92|
000052  2f54              CMP      r7,#0x54
000054  d07e              BEQ      |L13.340|
000056  2f74              CMP      r7,#0x74
000058  d1f1              BNE      |L13.62|
00005a  e0a2              B        |L13.418|
                  |L13.92|
00005c  2fa1              CMP      r7,#0xa1
00005e  d002              BEQ      |L13.102|
000060  2fbe              CMP      r7,#0xbe
000062  d1ec              BNE      |L13.62|
000064  e015              B        |L13.146|
                  |L13.102|
;;;354    	{
;;;355            case ENABLE_DOWN:   /* download be enble */
;;;356                TxdBuf[i++] = ORDER;
000066  2213              MOVS     r2,#0x13
000068  4620              MOV      r0,r4
00006a  1c61              ADDS     r1,r4,#1
00006c  b2cc              UXTB     r4,r1
00006e  a90a              ADD      r1,sp,#0x28
000070  540a              STRB     r2,[r1,r0]
;;;357                bcc += ORDER;
000072  f1050013          ADD      r0,r5,#0x13
000076  b2c5              UXTB     r5,r0
;;;358                TxdBuf[i++] = frame_type;
000078  4620              MOV      r0,r4
00007a  1c61              ADDS     r1,r4,#1
00007c  b2cc              UXTB     r4,r1
00007e  a90a              ADD      r1,sp,#0x28
000080  540f              STRB     r7,[r1,r0]
;;;359                bcc += frame_type;
000082  19e8              ADDS     r0,r5,r7
000084  b2c5              UXTB     r5,r0
;;;360                TxdBuf[i++] = bcc;
000086  4620              MOV      r0,r4
000088  1c61              ADDS     r1,r4,#1
00008a  b2cc              UXTB     r4,r1
00008c  a90a              ADD      r1,sp,#0x28
00008e  540d              STRB     r5,[r1,r0]
;;;361            break;
000090  e281              B        |L13.1430|
                  |L13.146|
;;;362    
;;;363    		case READ_VERSION:
;;;364    			TxdBuf[i++] = TEXT;
000092  2212              MOVS     r2,#0x12
000094  4620              MOV      r0,r4
000096  1c61              ADDS     r1,r4,#1
000098  b2cc              UXTB     r4,r1
00009a  a90a              ADD      r1,sp,#0x28
00009c  540a              STRB     r2,[r1,r0]
;;;365                bcc += TEXT;
00009e  f1050012          ADD      r0,r5,#0x12
0000a2  b2c5              UXTB     r5,r0
;;;366                TxdBuf[i++] = 0xb1;
0000a4  22b1              MOVS     r2,#0xb1
0000a6  4620              MOV      r0,r4
0000a8  1c61              ADDS     r1,r4,#1
0000aa  b2cc              UXTB     r4,r1
0000ac  a90a              ADD      r1,sp,#0x28
0000ae  540a              STRB     r2,[r1,r0]
;;;367                bcc += 0xb1;
0000b0  f10500b1          ADD      r0,r5,#0xb1
0000b4  b2c5              UXTB     r5,r0
;;;368    			TxdBuf[i++] = strlen(APPVERSION);
0000b6  48d3              LDR      r0,|L13.1028|
0000b8  f7fffffe          BL       strlen
0000bc  b2c2              UXTB     r2,r0
0000be  4620              MOV      r0,r4
0000c0  1c61              ADDS     r1,r4,#1
0000c2  b2cc              UXTB     r4,r1
0000c4  a90a              ADD      r1,sp,#0x28
0000c6  540a              STRB     r2,[r1,r0]
;;;369    			bcc += strlen(APPVERSION);
0000c8  48ce              LDR      r0,|L13.1028|
0000ca  f7fffffe          BL       strlen
0000ce  4428              ADD      r0,r0,r5
0000d0  b2c5              UXTB     r5,r0
;;;370    			for(j = 0; j < strlen(APPVERSION); j++)
0000d2  2600              MOVS     r6,#0
0000d4  e00c              B        |L13.240|
                  |L13.214|
;;;371    			{
;;;372    				TxdBuf[i++] = APPVERSION[j];
0000d6  48cb              LDR      r0,|L13.1028|
0000d8  5d82              LDRB     r2,[r0,r6]
0000da  4620              MOV      r0,r4
0000dc  1c61              ADDS     r1,r4,#1
0000de  b2cc              UXTB     r4,r1
0000e0  a90a              ADD      r1,sp,#0x28
0000e2  540a              STRB     r2,[r1,r0]
;;;373                	bcc += APPVERSION[j];	
0000e4  48c7              LDR      r0,|L13.1028|
0000e6  5d80              LDRB     r0,[r0,r6]
0000e8  4428              ADD      r0,r0,r5
0000ea  b2c5              UXTB     r5,r0
0000ec  1c70              ADDS     r0,r6,#1              ;370
0000ee  b2c6              UXTB     r6,r0                 ;370
                  |L13.240|
0000f0  48c4              LDR      r0,|L13.1028|
0000f2  f7fffffe          BL       strlen
0000f6  42b0              CMP      r0,r6                 ;370
0000f8  d8ed              BHI      |L13.214|
;;;374    			}
;;;375    			TxdBuf[i++] = ETX;
0000fa  2203              MOVS     r2,#3
0000fc  4621              MOV      r1,r4
0000fe  1c60              ADDS     r0,r4,#1
000100  b2c4              UXTB     r4,r0
000102  a80a              ADD      r0,sp,#0x28
000104  5442              STRB     r2,[r0,r1]
;;;376    			bcc += ETX;
000106  1ce8              ADDS     r0,r5,#3
000108  b2c5              UXTB     r5,r0
;;;377                TxdBuf[i++] = bcc;	
00010a  4620              MOV      r0,r4
00010c  1c61              ADDS     r1,r4,#1
00010e  b2cc              UXTB     r4,r1
000110  a90a              ADD      r1,sp,#0x28
000112  540d              STRB     r5,[r1,r0]
;;;378    		break;
000114  e23f              B        |L13.1430|
                  |L13.278|
000116  e0b1              B        |L13.636|
000118  e005              B        |L13.294|
00011a  e003              B        |L13.292|
                  |L13.284|
00011c  e1be              B        |L13.1180|
                  |L13.286|
00011e  e236              B        |L13.1422|
                  |L13.288|
000120  e072              B        |L13.520|
000122  e006              B        |L13.306|
                  |L13.292|
;;;379            			 
;;;380    		case CMDSUCC:
;;;381    		case CMDERRO:
000124  bf00              NOP      
                  |L13.294|
;;;382    			i = 0;						   //加密磁头协议
000126  2400              MOVS     r4,#0
;;;383    			TxdBuf[i++] = frame_type;
000128  4621              MOV      r1,r4
00012a  1c64              ADDS     r4,r4,#1
00012c  a80a              ADD      r0,sp,#0x28
00012e  5447              STRB     r7,[r0,r1]
;;;384    			break;
000130  e231              B        |L13.1430|
                  |L13.306|
;;;385    		case GETSECURITYLEVEL:					//0x7E	/* get security level */
;;;386    			if(RxdBuf[2] == GETSECURITYLEVEL) 
000132  48b5              LDR      r0,|L13.1032|
000134  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000136  287e              CMP      r0,#0x7e
000138  d130              BNE      |L13.412|
;;;387    			{
;;;388    				i = 0;
00013a  2400              MOVS     r4,#0
;;;389    				TxdBuf[i++] = 0x06; 			// 06
00013c  2206              MOVS     r2,#6
00013e  4621              MOV      r1,r4
000140  1c64              ADDS     r4,r4,#1
000142  a80a              ADD      r0,sp,#0x28
000144  5442              STRB     r2,[r0,r1]
;;;390    				TxdBuf[i++] = RxdBuf[0]; 		// 02
000146  48b0              LDR      r0,|L13.1032|
000148  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
00014a  4621              MOV      r1,r4
00014c  1c64              ADDS     r4,r4,#1
00014e  a80a              ADD      r0,sp,#0x28
000150  5442              STRB     r2,[r0,r1]
;;;391    				bcc = RxdBuf[0];
000152  e000              B        |L13.342|
                  |L13.340|
000154  e126              B        |L13.932|
                  |L13.342|
000156  48ac              LDR      r0,|L13.1032|
000158  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;392    				TxdBuf[i++] = GETSECURITYLEVEL;
00015a  227e              MOVS     r2,#0x7e
00015c  4621              MOV      r1,r4
00015e  1c64              ADDS     r4,r4,#1
000160  a80a              ADD      r0,sp,#0x28
000162  5442              STRB     r2,[r0,r1]
;;;393    	            bcc ^= GETSECURITYLEVEL;
000164  f085057e          EOR      r5,r5,#0x7e
;;;394    				TxdBuf[i++] = 0x01;
000168  2201              MOVS     r2,#1
00016a  4621              MOV      r1,r4
00016c  1c64              ADDS     r4,r4,#1
00016e  5442              STRB     r2,[r0,r1]
;;;395    	            bcc ^= 0x01;
000170  f0850501          EOR      r5,r5,#1
;;;396    				//ReadENCKEY();
;;;397    				TxdBuf[i++] = ENC_KEY.temp.level;
000174  48a5              LDR      r0,|L13.1036|
000176  7842              LDRB     r2,[r0,#1]  ; ENC_KEY
000178  4621              MOV      r1,r4
00017a  1c64              ADDS     r4,r4,#1
00017c  a80a              ADD      r0,sp,#0x28
00017e  5442              STRB     r2,[r0,r1]
;;;398    	            bcc ^= ENC_KEY.temp.level; 				
000180  48a2              LDR      r0,|L13.1036|
000182  7840              LDRB     r0,[r0,#1]  ; ENC_KEY
000184  4045              EORS     r5,r5,r0
;;;399    				TxdBuf[i++] = ETX;
000186  2203              MOVS     r2,#3
000188  4621              MOV      r1,r4
00018a  1c64              ADDS     r4,r4,#1
00018c  a80a              ADD      r0,sp,#0x28
00018e  5442              STRB     r2,[r0,r1]
;;;400    	            bcc ^= ETX;
000190  f0850503          EOR      r5,r5,#3
;;;401    	            TxdBuf[i++] = bcc;
000194  4621              MOV      r1,r4
000196  1c64              ADDS     r4,r4,#1
000198  5445              STRB     r5,[r0,r1]
;;;402    				break;
00019a  e1fc              B        |L13.1430|
                  |L13.412|
;;;403    			}
;;;404    			init_serial_boot();	
00019c  f7fffffe          BL       init_serial_boot
;;;405    			break;
0001a0  e1f9              B        |L13.1430|
                  |L13.418|
;;;406    		case GETCHALLENGE:
;;;407    			if(RxdBuf[2] == GETCHALLENGE) 
0001a2  4899              LDR      r0,|L13.1032|
0001a4  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
0001a6  2874              CMP      r0,#0x74
0001a8  d12b              BNE      |L13.514|
;;;408    			{
;;;409    				i = 0;
0001aa  2400              MOVS     r4,#0
;;;410    				TxdBuf[i++] = 0x06; 			// 06
0001ac  2206              MOVS     r2,#6
0001ae  4621              MOV      r1,r4
0001b0  1c64              ADDS     r4,r4,#1
0001b2  a80a              ADD      r0,sp,#0x28
0001b4  5442              STRB     r2,[r0,r1]
;;;411    				TxdBuf[i++] = RxdBuf[0]; 		// 02
0001b6  4894              LDR      r0,|L13.1032|
0001b8  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
0001ba  4621              MOV      r1,r4
0001bc  1c64              ADDS     r4,r4,#1
0001be  a80a              ADD      r0,sp,#0x28
0001c0  5442              STRB     r2,[r0,r1]
;;;412    				bcc = RxdBuf[0];
0001c2  4891              LDR      r0,|L13.1032|
0001c4  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;413    				for(j=0; j<8; j++)  //拷贝随机数、计算异或和
0001c6  2600              MOVS     r6,#0
0001c8  e00b              B        |L13.482|
                  |L13.458|
;;;414    				{
;;;415    					TxdBuf[i++] = random[j];
0001ca  4891              LDR      r0,|L13.1040|
0001cc  5d82              LDRB     r2,[r0,r6]
0001ce  4620              MOV      r0,r4
0001d0  1c61              ADDS     r1,r4,#1
0001d2  b2cc              UXTB     r4,r1
0001d4  a90a              ADD      r1,sp,#0x28
0001d6  540a              STRB     r2,[r1,r0]
;;;416    					bcc ^= random[j];
0001d8  488d              LDR      r0,|L13.1040|
0001da  5d80              LDRB     r0,[r0,r6]
0001dc  4045              EORS     r5,r5,r0
0001de  1c70              ADDS     r0,r6,#1              ;413
0001e0  b2c6              UXTB     r6,r0                 ;413
                  |L13.482|
0001e2  2e08              CMP      r6,#8                 ;413
0001e4  dbf1              BLT      |L13.458|
;;;417    				}
;;;418    				TxdBuf[i++] = ETX;
0001e6  2203              MOVS     r2,#3
0001e8  4620              MOV      r0,r4
0001ea  1c61              ADDS     r1,r4,#1
0001ec  b2cc              UXTB     r4,r1
0001ee  a90a              ADD      r1,sp,#0x28
0001f0  540a              STRB     r2,[r1,r0]
;;;419    	            bcc ^= ETX;
0001f2  f0850503          EOR      r5,r5,#3
;;;420    	            TxdBuf[i++] = bcc;
0001f6  4620              MOV      r0,r4
0001f8  1c61              ADDS     r1,r4,#1
0001fa  b2cc              UXTB     r4,r1
0001fc  a90a              ADD      r1,sp,#0x28
0001fe  540d              STRB     r5,[r1,r0]
;;;421    				break;
000200  e1c9              B        |L13.1430|
                  |L13.514|
;;;422    			}
;;;423    			init_serial_boot();			
000202  f7fffffe          BL       init_serial_boot
;;;424    			break;			
000206  e1c6              B        |L13.1430|
                  |L13.520|
;;;425    		case READID:
;;;426    			if(RxdBuf[2] == READID) 
000208  487f              LDR      r0,|L13.1032|
00020a  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
00020c  2822              CMP      r0,#0x22
00020e  d132              BNE      |L13.630|
;;;427    			{
;;;428    				i = 0;
000210  2400              MOVS     r4,#0
;;;429    				TxdBuf[i++] = 0xFF; 			// FF
000212  22ff              MOVS     r2,#0xff
000214  4621              MOV      r1,r4
000216  1c64              ADDS     r4,r4,#1
000218  a80a              ADD      r0,sp,#0x28
00021a  5442              STRB     r2,[r0,r1]
;;;430    				TxdBuf[i++] = 0x06; 			// 06
00021c  2206              MOVS     r2,#6
00021e  4621              MOV      r1,r4
000220  1c64              ADDS     r4,r4,#1
000222  5442              STRB     r2,[r0,r1]
;;;431    				TxdBuf[i++] = RxdBuf[0]; 		// 02
000224  4878              LDR      r0,|L13.1032|
000226  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
000228  4621              MOV      r1,r4
00022a  1c64              ADDS     r4,r4,#1
00022c  a80a              ADD      r0,sp,#0x28
00022e  5442              STRB     r2,[r0,r1]
;;;432    				bcc = RxdBuf[0];
000230  4875              LDR      r0,|L13.1032|
000232  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;433    				for(j=0; j<strlen(SHID); j++)  //拷贝安全磁头ID、计算异或和
000234  2600              MOVS     r6,#0
000236  e00b              B        |L13.592|
                  |L13.568|
;;;434    				{
;;;435    					TxdBuf[i++] = SHID[j];
000238  4876              LDR      r0,|L13.1044|
00023a  5d82              LDRB     r2,[r0,r6]
00023c  4620              MOV      r0,r4
00023e  1c61              ADDS     r1,r4,#1
000240  b2cc              UXTB     r4,r1
000242  a90a              ADD      r1,sp,#0x28
000244  540a              STRB     r2,[r1,r0]
;;;436    					bcc ^= SHID[j];
000246  4873              LDR      r0,|L13.1044|
000248  5d80              LDRB     r0,[r0,r6]
00024a  4045              EORS     r5,r5,r0
00024c  1c70              ADDS     r0,r6,#1              ;433
00024e  b2c6              UXTB     r6,r0                 ;433
                  |L13.592|
000250  4870              LDR      r0,|L13.1044|
000252  f7fffffe          BL       strlen
000256  42b0              CMP      r0,r6                 ;433
000258  d8ee              BHI      |L13.568|
;;;437    				}
;;;438    				TxdBuf[i++] = ETX;
00025a  2203              MOVS     r2,#3
00025c  4620              MOV      r0,r4
00025e  1c61              ADDS     r1,r4,#1
000260  b2cc              UXTB     r4,r1
000262  a90a              ADD      r1,sp,#0x28
000264  540a              STRB     r2,[r1,r0]
;;;439    	            bcc ^= ETX;
000266  f0850503          EOR      r5,r5,#3
;;;440    	            TxdBuf[i++] = bcc;
00026a  4620              MOV      r0,r4
00026c  1c61              ADDS     r1,r4,#1
00026e  b2cc              UXTB     r4,r1
000270  a90a              ADD      r1,sp,#0x28
000272  540d              STRB     r5,[r1,r0]
;;;441    				break;
000274  e18f              B        |L13.1430|
                  |L13.630|
;;;442    			}
;;;443    			init_serial_boot();
000276  f7fffffe          BL       init_serial_boot
;;;444    			break;
00027a  e18c              B        |L13.1430|
                  |L13.636|
;;;445    		case REVIEWKSN:
;;;446    			if(RxdBuf[2] == REVIEWKSN) 
00027c  4862              LDR      r0,|L13.1032|
00027e  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000280  2851              CMP      r0,#0x51
000282  d142              BNE      |L13.778|
;;;447    			{
;;;448    				i = 0;
000284  2400              MOVS     r4,#0
;;;449    				TxdBuf[i++] = 0x06; 			// 06
000286  2206              MOVS     r2,#6
000288  4621              MOV      r1,r4
00028a  1c64              ADDS     r4,r4,#1
00028c  a80a              ADD      r0,sp,#0x28
00028e  5442              STRB     r2,[r0,r1]
;;;450    				TxdBuf[i++] = RxdBuf[0]; 		// 02
000290  485d              LDR      r0,|L13.1032|
000292  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
000294  4621              MOV      r1,r4
000296  1c64              ADDS     r4,r4,#1
000298  a80a              ADD      r0,sp,#0x28
00029a  5442              STRB     r2,[r0,r1]
;;;451    				bcc = RxdBuf[0];
00029c  485a              LDR      r0,|L13.1032|
00029e  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;452    				TxdBuf[i++] = RxdBuf[2];		// 51
0002a0  7882              LDRB     r2,[r0,#2]  ; TempTrackDirtData
0002a2  4621              MOV      r1,r4
0002a4  1c64              ADDS     r4,r4,#1
0002a6  a80a              ADD      r0,sp,#0x28
0002a8  5442              STRB     r2,[r0,r1]
;;;453    				bcc ^= RxdBuf[2];
0002aa  4857              LDR      r0,|L13.1032|
0002ac  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
0002ae  4045              EORS     r5,r5,r0
;;;454    				TxdBuf[i++] = 0x0B;				// 0B
0002b0  220b              MOVS     r2,#0xb
0002b2  4621              MOV      r1,r4
0002b4  1c64              ADDS     r4,r4,#1
0002b6  a80a              ADD      r0,sp,#0x28
0002b8  5442              STRB     r2,[r0,r1]
;;;455    				bcc ^= 0x0B;
0002ba  f085050b          EOR      r5,r5,#0xb
;;;456    				TxdBuf[i++] = 0x0A;				// 0A
0002be  220a              MOVS     r2,#0xa
0002c0  4621              MOV      r1,r4
0002c2  1c64              ADDS     r4,r4,#1
0002c4  5442              STRB     r2,[r0,r1]
;;;457    				bcc ^= 0x0A;
0002c6  f085050a          EOR      r5,r5,#0xa
;;;458    				
;;;459    				for(j=0; j< 10; j++)  			//拷贝KSN、计算异或和
0002ca  2600              MOVS     r6,#0
0002cc  e00d              B        |L13.746|
                  |L13.718|
;;;460    				{
;;;461    					TxdBuf[i++] = ENC_KEY.temp.ksn[j];
0002ce  484f              LDR      r0,|L13.1036|
0002d0  3024              ADDS     r0,r0,#0x24
0002d2  5d82              LDRB     r2,[r0,r6]
0002d4  4620              MOV      r0,r4
0002d6  1c61              ADDS     r1,r4,#1
0002d8  b2cc              UXTB     r4,r1
0002da  a90a              ADD      r1,sp,#0x28
0002dc  540a              STRB     r2,[r1,r0]
;;;462    					bcc ^= ENC_KEY.temp.ksn[j];
0002de  484b              LDR      r0,|L13.1036|
0002e0  3024              ADDS     r0,r0,#0x24
0002e2  5d80              LDRB     r0,[r0,r6]
0002e4  4045              EORS     r5,r5,r0
0002e6  1c70              ADDS     r0,r6,#1              ;459
0002e8  b2c6              UXTB     r6,r0                 ;459
                  |L13.746|
0002ea  2e0a              CMP      r6,#0xa               ;459
0002ec  dbef              BLT      |L13.718|
;;;463    				}
;;;464    				TxdBuf[i++] = ETX;
0002ee  2203              MOVS     r2,#3
0002f0  4620              MOV      r0,r4
0002f2  1c61              ADDS     r1,r4,#1
0002f4  b2cc              UXTB     r4,r1
0002f6  a90a              ADD      r1,sp,#0x28
0002f8  540a              STRB     r2,[r1,r0]
;;;465    	            bcc ^= ETX;
0002fa  f0850503          EOR      r5,r5,#3
;;;466    	            TxdBuf[i++] = bcc;
0002fe  4620              MOV      r0,r4
000300  1c61              ADDS     r1,r4,#1
000302  b2cc              UXTB     r4,r1
000304  a90a              ADD      r1,sp,#0x28
000306  540d              STRB     r5,[r1,r0]
;;;467    				break;
000308  e145              B        |L13.1430|
                  |L13.778|
;;;468    			}
;;;469    			init_serial_boot();
00030a  f7fffffe          BL       init_serial_boot
;;;470    			break;
00030e  e142              B        |L13.1430|
                  |L13.784|
;;;471    		case REVIEWSN:							//0x4E	/* review serial number */
;;;472    			if(RxdBuf[2] == REVIEWSN) 
000310  483d              LDR      r0,|L13.1032|
000312  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000314  284e              CMP      r0,#0x4e
000316  d142              BNE      |L13.926|
;;;473    			{
;;;474    				i = 0;
000318  2400              MOVS     r4,#0
;;;475    				TxdBuf[i++] = 0x06; 			// 06
00031a  2206              MOVS     r2,#6
00031c  4621              MOV      r1,r4
00031e  1c64              ADDS     r4,r4,#1
000320  a80a              ADD      r0,sp,#0x28
000322  5442              STRB     r2,[r0,r1]
;;;476    				TxdBuf[i++] = RxdBuf[0]; 		// 02
000324  4838              LDR      r0,|L13.1032|
000326  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
000328  4621              MOV      r1,r4
00032a  1c64              ADDS     r4,r4,#1
00032c  a80a              ADD      r0,sp,#0x28
00032e  5442              STRB     r2,[r0,r1]
;;;477    				bcc = RxdBuf[0];
000330  4835              LDR      r0,|L13.1032|
000332  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;478    				TxdBuf[i++] = RxdBuf[2];		// 4E
000334  7882              LDRB     r2,[r0,#2]  ; TempTrackDirtData
000336  4621              MOV      r1,r4
000338  1c64              ADDS     r4,r4,#1
00033a  a80a              ADD      r0,sp,#0x28
00033c  5442              STRB     r2,[r0,r1]
;;;479    				bcc ^= RxdBuf[2];
00033e  4832              LDR      r0,|L13.1032|
000340  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
000342  4045              EORS     r5,r5,r0
;;;480    				TxdBuf[i++] = 0x09;				// 09
000344  2209              MOVS     r2,#9
000346  4621              MOV      r1,r4
000348  1c64              ADDS     r4,r4,#1
00034a  a80a              ADD      r0,sp,#0x28
00034c  5442              STRB     r2,[r0,r1]
;;;481    				bcc ^= 0x09;
00034e  f0850509          EOR      r5,r5,#9
;;;482    				TxdBuf[i++] = 0x08;				// 08
000352  2208              MOVS     r2,#8
000354  4621              MOV      r1,r4
000356  1c64              ADDS     r4,r4,#1
000358  5442              STRB     r2,[r0,r1]
;;;483    				bcc ^= 0x08;
00035a  f0850508          EOR      r5,r5,#8
;;;484    				
;;;485    				for(j=0; j< 8; j++)  			//拷贝SN、计算异或和
00035e  2600              MOVS     r6,#0
000360  e00d              B        |L13.894|
                  |L13.866|
;;;486    				{
;;;487    					TxdBuf[i++] = ENC_KEY.temp.sn[j];
000362  482a              LDR      r0,|L13.1036|
000364  3036              ADDS     r0,r0,#0x36
000366  5d82              LDRB     r2,[r0,r6]
000368  4620              MOV      r0,r4
00036a  1c61              ADDS     r1,r4,#1
00036c  b2cc              UXTB     r4,r1
00036e  a90a              ADD      r1,sp,#0x28
000370  540a              STRB     r2,[r1,r0]
;;;488    					bcc ^= ENC_KEY.temp.sn[j];
000372  4826              LDR      r0,|L13.1036|
000374  3036              ADDS     r0,r0,#0x36
000376  5d80              LDRB     r0,[r0,r6]
000378  4045              EORS     r5,r5,r0
00037a  1c70              ADDS     r0,r6,#1              ;485
00037c  b2c6              UXTB     r6,r0                 ;485
                  |L13.894|
00037e  2e08              CMP      r6,#8                 ;485
000380  dbef              BLT      |L13.866|
;;;489    				}
;;;490    				TxdBuf[i++] = ETX;
000382  2203              MOVS     r2,#3
000384  4620              MOV      r0,r4
000386  1c61              ADDS     r1,r4,#1
000388  b2cc              UXTB     r4,r1
00038a  a90a              ADD      r1,sp,#0x28
00038c  540a              STRB     r2,[r1,r0]
;;;491    	            bcc ^= ETX;
00038e  f0850503          EOR      r5,r5,#3
;;;492    	            TxdBuf[i++] = bcc;
000392  4620              MOV      r0,r4
000394  1c61              ADDS     r1,r4,#1
000396  b2cc              UXTB     r4,r1
000398  a90a              ADD      r1,sp,#0x28
00039a  540d              STRB     r5,[r1,r0]
;;;493    				break;
00039c  e0fb              B        |L13.1430|
                  |L13.926|
;;;494    			}
;;;495    			init_serial_boot();
00039e  f7fffffe          BL       init_serial_boot
;;;496    			break;
0003a2  e0f8              B        |L13.1430|
                  |L13.932|
;;;497    		case SETSID:							//0x54	/* set Session ID */
;;;498    			if(RxdBuf[2] == SETSID) 
0003a4  4818              LDR      r0,|L13.1032|
0003a6  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
0003a8  2854              CMP      r0,#0x54
0003aa  d151              BNE      |L13.1104|
;;;499    			{
;;;500    				i = 0;
0003ac  2400              MOVS     r4,#0
;;;501    				TxdBuf[i++] = 0x06; 			// 06
0003ae  2206              MOVS     r2,#6
0003b0  4621              MOV      r1,r4
0003b2  1c64              ADDS     r4,r4,#1
0003b4  a80a              ADD      r0,sp,#0x28
0003b6  5442              STRB     r2,[r0,r1]
;;;502    				TxdBuf[i++] = RxdBuf[0]; 		// 02
0003b8  4813              LDR      r0,|L13.1032|
0003ba  7802              LDRB     r2,[r0,#0]  ; TempTrackDirtData
0003bc  4621              MOV      r1,r4
0003be  1c64              ADDS     r4,r4,#1
0003c0  a80a              ADD      r0,sp,#0x28
0003c2  5442              STRB     r2,[r0,r1]
;;;503    				bcc = RxdBuf[0];
0003c4  4810              LDR      r0,|L13.1032|
0003c6  7805              LDRB     r5,[r0,#0]  ; TempTrackDirtData
;;;504    				TxdBuf[i++] = RxdBuf[2];		// 54
0003c8  7882              LDRB     r2,[r0,#2]  ; TempTrackDirtData
0003ca  4621              MOV      r1,r4
0003cc  1c64              ADDS     r4,r4,#1
0003ce  a80a              ADD      r0,sp,#0x28
0003d0  5442              STRB     r2,[r0,r1]
;;;505    				bcc ^= RxdBuf[2];
0003d2  480d              LDR      r0,|L13.1032|
0003d4  7880              LDRB     r0,[r0,#2]  ; TempTrackDirtData
0003d6  4045              EORS     r5,r5,r0
;;;506    				TxdBuf[i++] = 0x09;				// 09
0003d8  2209              MOVS     r2,#9
0003da  4621              MOV      r1,r4
0003dc  1c64              ADDS     r4,r4,#1
0003de  a80a              ADD      r0,sp,#0x28
0003e0  5442              STRB     r2,[r0,r1]
;;;507    				bcc ^= 0x09;
0003e2  f0850509          EOR      r5,r5,#9
;;;508    				TxdBuf[i++] = 0x08;				// 08
0003e6  2208              MOVS     r2,#8
0003e8  4621              MOV      r1,r4
0003ea  1c64              ADDS     r4,r4,#1
0003ec  5442              STRB     r2,[r0,r1]
;;;509    				bcc ^= 0x08;
0003ee  f0850508          EOR      r5,r5,#8
;;;510    				
;;;511    				for(j=0; j< 8; j++)  			//拷贝SID、计算异或和
0003f2  2600              MOVS     r6,#0
0003f4  e01c              B        |L13.1072|
0003f6  0000              DCW      0x0000
                  |L13.1016|
0003f8  ff00              DCB      255,0
0003fa  0600              DCB      6,0
0003fc  00                DCB      0
0003fd  00                DCB      0
0003fe  00                DCB      0
0003ff  00                DCB      0
000400  00                DCB      0
000401  00                DCB      0
000402  00                DCB      0
000403  00                DCB      0
                  |L13.1028|
                          DCD      APPVERSION
                  |L13.1032|
                          DCD      TempTrackDirtData
                  |L13.1036|
                          DCD      ENC_KEY
                  |L13.1040|
                          DCD      random
                  |L13.1044|
                          DCD      SHID
                  |L13.1048|
;;;512    				{
;;;513    					TxdBuf[i++] = ENC_KEY.temp.sid[j];
000418  4862              LDR      r0,|L13.1444|
00041a  5d82              LDRB     r2,[r0,r6]
00041c  4620              MOV      r0,r4
00041e  1c61              ADDS     r1,r4,#1
000420  b2cc              UXTB     r4,r1
000422  a90a              ADD      r1,sp,#0x28
000424  540a              STRB     r2,[r1,r0]
;;;514    					bcc ^= ENC_KEY.temp.sid[j];
000426  485f              LDR      r0,|L13.1444|
000428  5d80              LDRB     r0,[r0,r6]
00042a  4045              EORS     r5,r5,r0
00042c  1c70              ADDS     r0,r6,#1              ;511
00042e  b2c6              UXTB     r6,r0                 ;511
                  |L13.1072|
000430  2e08              CMP      r6,#8                 ;511
000432  dbf1              BLT      |L13.1048|
;;;515    				}
;;;516    				TxdBuf[i++] = ETX;
000434  2203              MOVS     r2,#3
000436  4620              MOV      r0,r4
000438  1c61              ADDS     r1,r4,#1
00043a  b2cc              UXTB     r4,r1
00043c  a90a              ADD      r1,sp,#0x28
00043e  540a              STRB     r2,[r1,r0]
;;;517    	            bcc ^= ETX;
000440  f0850503          EOR      r5,r5,#3
;;;518    	            TxdBuf[i++] = bcc;
000444  4620              MOV      r0,r4
000446  1c61              ADDS     r1,r4,#1
000448  b2cc              UXTB     r4,r1
00044a  a90a              ADD      r1,sp,#0x28
00044c  540d              STRB     r5,[r1,r0]
;;;519    				break;
00044e  e0a2              B        |L13.1430|
                  |L13.1104|
;;;520    			}
;;;521    			init_serial_boot();
000450  f7fffffe          BL       init_serial_boot
;;;522    			break;
000454  e09f              B        |L13.1430|
                  |L13.1110|
;;;523    		case SETKEYCOMMU:
;;;524    			{
;;;525    				i = 0;
000456  2400              MOVS     r4,#0
;;;526    				if(0 == SetKeyFlag)
000458  4853              LDR      r0,|L13.1448|
00045a  7800              LDRB     r0,[r0,#0]  ; SetKeyFlag
00045c  b9e8              CBNZ     r0,|L13.1178|
;;;527    				{
;;;528    					memcpy(TxdBuf,"\x06\x02\x46\x46\x00\x00\x00\x00\x00\x00\x00\x00\x0D\x0A\x03\x00",16);
00045e  a353              ADR      r3,|L13.1452|
000460  cb0f              LDM      r3,{r0-r3}
000462  e9cd230c          STRD     r2,r3,[sp,#0x30]
000466  e9cd010a          STRD     r0,r1,[sp,#0x28]
;;;529    					to64frombits(TempBuf,"\xFF\x00\x01\x04\xFA",5);
00046a  2205              MOVS     r2,#5
00046c  a154              ADR      r1,|L13.1472|
00046e  a805              ADD      r0,sp,#0x14
000470  f7fffffe          BL       to64frombits
;;;530    					memcpy(&TxdBuf[4],TempBuf,8);
000474  e9dd0105          LDRD     r0,r1,[sp,#0x14]
000478  e9cd010b          STRD     r0,r1,[sp,#0x2c]
;;;531    					for(bcc = 0, i = 2; i < 15; i++)
00047c  2500              MOVS     r5,#0
00047e  2402              MOVS     r4,#2
000480  e004              B        |L13.1164|
                  |L13.1154|
;;;532    						bcc ^= TxdBuf[i];
000482  a80a              ADD      r0,sp,#0x28
000484  5d00              LDRB     r0,[r0,r4]
000486  4045              EORS     r5,r5,r0
000488  1c60              ADDS     r0,r4,#1              ;531
00048a  b2c4              UXTB     r4,r0                 ;531
                  |L13.1164|
00048c  2c0f              CMP      r4,#0xf               ;531
00048e  dbf8              BLT      |L13.1154|
;;;533    					TxdBuf[i++] = bcc;
000490  4620              MOV      r0,r4
000492  1c61              ADDS     r1,r4,#1
000494  b2cc              UXTB     r4,r1
000496  a90a              ADD      r1,sp,#0x28
000498  540d              STRB     r5,[r1,r0]
                  |L13.1178|
;;;534    				}
;;;535    			}
;;;536    			break;
00049a  e07c              B        |L13.1430|
                  |L13.1180|
;;;537    		case SETKEYVALUE:
;;;538    			{
;;;539    				i = 0;
00049c  2400              MOVS     r4,#0
;;;540    				if(1 == SetKeyFlag)
00049e  4842              LDR      r0,|L13.1448|
0004a0  7800              LDRB     r0,[r0,#0]  ; SetKeyFlag
0004a2  2801              CMP      r0,#1
0004a4  d137              BNE      |L13.1302|
;;;541    				{
;;;542    					memcpy(TxdBuf,"\x06\x02\x46\x46\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0D\x0A\x03\x00",23);
0004a6  2217              MOVS     r2,#0x17
0004a8  a147              ADR      r1,|L13.1480|
0004aa  a80a              ADD      r0,sp,#0x28
0004ac  f7fffffe          BL       __aeabi_memcpy4
;;;543    					GetKeyCkeckValue(ENC_KEY.temp.ksn,pBKCV,8,ET_DES_MS);
0004b0  2300              MOVS     r3,#0
0004b2  2208              MOVS     r2,#8
0004b4  a903              ADD      r1,sp,#0xc
0004b6  483b              LDR      r0,|L13.1444|
0004b8  380a              SUBS     r0,r0,#0xa
0004ba  f7fffffe          BL       GetKeyCkeckValue
;;;544    					HexToAscii(pBKCV, bpSEncod+3, 3);
0004be  2203              MOVS     r2,#3
0004c0  f10d0103          ADD      r1,sp,#3
0004c4  a803              ADD      r0,sp,#0xc
0004c6  f7fffffe          BL       HexToAscii
;;;545    					for(bcc = 0, i = 0; i < 9; i++)
0004ca  2500              MOVS     r5,#0
0004cc  bf00              NOP      
0004ce  e004              B        |L13.1242|
                  |L13.1232|
;;;546    						bcc ^= bpSEncod[i];
0004d0  f81d0004          LDRB     r0,[sp,r4]
0004d4  4045              EORS     r5,r5,r0
0004d6  1c60              ADDS     r0,r4,#1              ;545
0004d8  b2c4              UXTB     r4,r0                 ;545
                  |L13.1242|
0004da  2c09              CMP      r4,#9                 ;545
0004dc  dbf8              BLT      |L13.1232|
;;;547    					bpSEncod[i] = bcc;
0004de  f80d5004          STRB     r5,[sp,r4]
;;;548    					to64frombits(TempBuf,bpSEncod,10);
0004e2  220a              MOVS     r2,#0xa
0004e4  4669              MOV      r1,sp
0004e6  a805              ADD      r0,sp,#0x14
0004e8  f7fffffe          BL       to64frombits
;;;549    					memcpy(&TxdBuf[4],TempBuf,15);					
0004ec  220f              MOVS     r2,#0xf
0004ee  a905              ADD      r1,sp,#0x14
0004f0  a80b              ADD      r0,sp,#0x2c
0004f2  f7fffffe          BL       __aeabi_memcpy4
;;;550    					for(bcc = 0, i = 2; i < 22; i++)
0004f6  2500              MOVS     r5,#0
0004f8  2402              MOVS     r4,#2
0004fa  e004              B        |L13.1286|
                  |L13.1276|
;;;551    						bcc ^= TxdBuf[i];
0004fc  a80a              ADD      r0,sp,#0x28
0004fe  5d00              LDRB     r0,[r0,r4]
000500  4045              EORS     r5,r5,r0
000502  1c60              ADDS     r0,r4,#1              ;550
000504  b2c4              UXTB     r4,r0                 ;550
                  |L13.1286|
000506  2c16              CMP      r4,#0x16              ;550
000508  dbf8              BLT      |L13.1276|
;;;552    					TxdBuf[i++] = bcc;
00050a  4620              MOV      r0,r4
00050c  1c61              ADDS     r1,r4,#1
00050e  b2cc              UXTB     r4,r1
000510  a90a              ADD      r1,sp,#0x28
000512  540d              STRB     r5,[r1,r0]
000514  e03a              B        |L13.1420|
                  |L13.1302|
;;;553    				}
;;;554    				else if(2 == SetKeyFlag)
000516  4824              LDR      r0,|L13.1448|
000518  7800              LDRB     r0,[r0,#0]  ; SetKeyFlag
00051a  2802              CMP      r0,#2
00051c  d136              BNE      |L13.1420|
;;;555    				{
;;;556    					memcpy(TxdBuf,"\x06\x02\x46\x46\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0D\x0A\x03\x00",23);
00051e  2217              MOVS     r2,#0x17
000520  a129              ADR      r1,|L13.1480|
000522  a80a              ADD      r0,sp,#0x28
000524  f7fffffe          BL       __aeabi_memcpy4
;;;557    					GetKeyCkeckValue(ENC_KEY.temp.key,pBKCV,16,ET_DES_MS);
000528  2300              MOVS     r3,#0
00052a  2210              MOVS     r2,#0x10
00052c  a903              ADD      r1,sp,#0xc
00052e  481d              LDR      r0,|L13.1444|
000530  381a              SUBS     r0,r0,#0x1a
000532  f7fffffe          BL       GetKeyCkeckValue
;;;558    					HexToAscii(pBKCV, bpSEncod+3, 3);
000536  2203              MOVS     r2,#3
000538  f10d0103          ADD      r1,sp,#3
00053c  a803              ADD      r0,sp,#0xc
00053e  f7fffffe          BL       HexToAscii
;;;559    					for(bcc = 0, i = 0; i < 9; i++)
000542  2500              MOVS     r5,#0
000544  2400              MOVS     r4,#0
000546  e004              B        |L13.1362|
                  |L13.1352|
;;;560    						bcc ^= bpSEncod[i];
000548  f81d0004          LDRB     r0,[sp,r4]
00054c  4045              EORS     r5,r5,r0
00054e  1c60              ADDS     r0,r4,#1              ;559
000550  b2c4              UXTB     r4,r0                 ;559
                  |L13.1362|
000552  2c09              CMP      r4,#9                 ;559
000554  dbf8              BLT      |L13.1352|
;;;561    					bpSEncod[i] = bcc;
000556  f80d5004          STRB     r5,[sp,r4]
;;;562    					to64frombits(TempBuf,bpSEncod,10);
00055a  220a              MOVS     r2,#0xa
00055c  4669              MOV      r1,sp
00055e  a805              ADD      r0,sp,#0x14
000560  f7fffffe          BL       to64frombits
;;;563    					memcpy(&TxdBuf[4],TempBuf,15);
000564  220f              MOVS     r2,#0xf
000566  a905              ADD      r1,sp,#0x14
000568  a80b              ADD      r0,sp,#0x2c
00056a  f7fffffe          BL       __aeabi_memcpy4
;;;564    					for(bcc = 0, i = 2; i < 22; i++)
00056e  2500              MOVS     r5,#0
000570  2402              MOVS     r4,#2
000572  e004              B        |L13.1406|
                  |L13.1396|
;;;565    						bcc ^= TxdBuf[i];
000574  a80a              ADD      r0,sp,#0x28
000576  5d00              LDRB     r0,[r0,r4]
000578  4045              EORS     r5,r5,r0
00057a  1c60              ADDS     r0,r4,#1              ;564
00057c  b2c4              UXTB     r4,r0                 ;564
                  |L13.1406|
00057e  2c16              CMP      r4,#0x16              ;564
000580  dbf8              BLT      |L13.1396|
;;;566    					TxdBuf[i++] = bcc;
000582  4620              MOV      r0,r4
000584  1c61              ADDS     r1,r4,#1
000586  b2cc              UXTB     r4,r1
000588  a90a              ADD      r1,sp,#0x28
00058a  540d              STRB     r5,[r1,r0]
                  |L13.1420|
;;;567    				}
;;;568    			}
;;;569    			break;
00058c  e003              B        |L13.1430|
                  |L13.1422|
;;;570            default:
;;;571            	init_serial_boot();
00058e  f7fffffe          BL       init_serial_boot
                  |L13.1426|
;;;572    			return;
;;;573        }
;;;574    	dev_com_write(TxdBuf, i);
;;;575    }
000592  b023              ADD      sp,sp,#0x8c
000594  bdf0              POP      {r4-r7,pc}
                  |L13.1430|
000596  bf00              NOP                            ;361
000598  4621              MOV      r1,r4                 ;574
00059a  a80a              ADD      r0,sp,#0x28           ;574
00059c  f7fffffe          BL       dev_com_write
0005a0  bf00              NOP      
0005a2  e7f6              B        |L13.1426|
;;;576    
                          ENDP

                  |L13.1444|
                          DCD      ENC_KEY+0x2e
                  |L13.1448|
                          DCD      SetKeyFlag
                  |L13.1452|
0005ac  06024646          DCB      6,2,"FF",0
0005b0  00      
0005b1  00                DCB      0
0005b2  00                DCB      0
0005b3  00                DCB      0
0005b4  00                DCB      0
0005b5  00                DCB      0
0005b6  00                DCB      0
0005b7  00                DCB      0
0005b8  0d0a0300          DCB      "\r\n",3,0
0005bc  00                DCB      0
0005bd  00                DCB      0
0005be  00                DCB      0
0005bf  00                DCB      0
                  |L13.1472|
0005c0  ff00              DCB      255,0
0005c2  0104fa00          DCB      1,4,250,0
0005c6  00                DCB      0
0005c7  00                DCB      0
                  |L13.1480|
0005c8  06024646          DCB      6,2,"FF",0
0005cc  00      
0005cd  00                DCB      0
0005ce  00                DCB      0
0005cf  00                DCB      0
0005d0  00                DCB      0
0005d1  00                DCB      0
0005d2  00                DCB      0
0005d3  00                DCB      0
0005d4  00                DCB      0
0005d5  00                DCB      0
0005d6  00                DCB      0
0005d7  00                DCB      0
0005d8  00                DCB      0
0005d9  00                DCB      0
0005da  00                DCB      0
0005db  0d0a0300          DCB      "\r\n",3,0
0005df  00                DCB      0

                          AREA ||.bss||, DATA, NOINIT, ALIGN=0

                  ENC_KEY
                          %        64
                  CryptoKey
                          %        16

                          AREA ||.constdata||, DATA, READONLY, ALIGN=0

                  SHID
000000  50462053          DCB      0x50,0x46,0x20,0x53
000004  65637572          DCB      0x65,0x63,0x75,0x72
000008  65486561          DCB      0x65,0x48,0x65,0x61
00000c  64526561          DCB      0x64,0x52,0x65,0x61
000010  64657220          DCB      0x64,0x65,0x72,0x20
000014  5620312e          DCB      0x56,0x20,0x31,0x2e
000018  303000            DCB      0x30,0x30,0x00
                  APPVERSION
00001b  56                DCB      0x56
00001c  42304153          DCB      0x42,0x30,0x41,0x53
000020  544d4731          DCB      0x54,0x4d,0x47,0x31
000024  37303332          DCB      0x37,0x30,0x33,0x32
000028  30303031          DCB      0x30,0x30,0x30,0x31
00002c  00                DCB      0x00

                          AREA ||.data||, DATA, ALIGN=0

                  base64digits
000000  41424344          DCB      0x41,0x42,0x43,0x44
000004  45464748          DCB      0x45,0x46,0x47,0x48
000008  494a4b4c          DCB      0x49,0x4a,0x4b,0x4c
00000c  4d4e4f50          DCB      0x4d,0x4e,0x4f,0x50
000010  51525354          DCB      0x51,0x52,0x53,0x54
000014  55565758          DCB      0x55,0x56,0x57,0x58
000018  595a6162          DCB      0x59,0x5a,0x61,0x62
00001c  63646566          DCB      0x63,0x64,0x65,0x66
000020  6768696a          DCB      0x67,0x68,0x69,0x6a
000024  6b6c6d6e          DCB      0x6b,0x6c,0x6d,0x6e
000028  6f707172          DCB      0x6f,0x70,0x71,0x72
00002c  73747576          DCB      0x73,0x74,0x75,0x76
000030  7778797a          DCB      0x77,0x78,0x79,0x7a
000034  30313233          DCB      0x30,0x31,0x32,0x33
000038  34353637          DCB      0x34,0x35,0x36,0x37
00003c  38392b2f          DCB      0x38,0x39,0x2b,0x2f
000040  00                DCB      0x00
                  base64val
000041  ffffff            DCB      0xff,0xff,0xff
000044  ffffffff          DCB      0xff,0xff,0xff,0xff
000048  ffffffff          DCB      0xff,0xff,0xff,0xff
00004c  ffffffff          DCB      0xff,0xff,0xff,0xff
000050  ffffffff          DCB      0xff,0xff,0xff,0xff
000054  ffffffff          DCB      0xff,0xff,0xff,0xff
000058  ffffffff          DCB      0xff,0xff,0xff,0xff
00005c  ffffffff          DCB      0xff,0xff,0xff,0xff
000060  ffffffff          DCB      0xff,0xff,0xff,0xff
000064  ffffffff          DCB      0xff,0xff,0xff,0xff
000068  ffffffff          DCB      0xff,0xff,0xff,0xff
00006c  3effffff          DCB      0x3e,0xff,0xff,0xff
000070  3f343536          DCB      0x3f,0x34,0x35,0x36
000074  3738393a          DCB      0x37,0x38,0x39,0x3a
000078  3b3c3dff          DCB      0x3b,0x3c,0x3d,0xff
00007c  ffffffff          DCB      0xff,0xff,0xff,0xff
000080  ffff0001          DCB      0xff,0xff,0x00,0x01
000084  02030405          DCB      0x02,0x03,0x04,0x05
000088  06070809          DCB      0x06,0x07,0x08,0x09
00008c  0a0b0c0d          DCB      0x0a,0x0b,0x0c,0x0d
000090  0e0f1011          DCB      0x0e,0x0f,0x10,0x11
000094  12131415          DCB      0x12,0x13,0x14,0x15
000098  16171819          DCB      0x16,0x17,0x18,0x19
00009c  ffffffff          DCB      0xff,0xff,0xff,0xff
0000a0  ffff1a1b          DCB      0xff,0xff,0x1a,0x1b
0000a4  1c1d1e1f          DCB      0x1c,0x1d,0x1e,0x1f
0000a8  20212223          DCB      0x20,0x21,0x22,0x23
0000ac  24252627          DCB      0x24,0x25,0x26,0x27
0000b0  28292a2b          DCB      0x28,0x29,0x2a,0x2b
0000b4  2c2d2e2f          DCB      0x2c,0x2d,0x2e,0x2f
0000b8  30313233          DCB      0x30,0x31,0x32,0x33
0000bc  ffffffff          DCB      0xff,0xff,0xff,0xff
0000c0  ff                DCB      0xff
                  WriteFlag
0000c1  00                DCB      0x00
                  GetNextFlag
0000c2  00                DCB      0x00
                  macstate
0000c3  00                DCB      0x00
                  encryptdatastatus
0000c4  00                DCB      0x00
                  SetKeyLen
0000c5  00                DCB      0x00
                  SetKeyFlag
0000c6  00                DCB      0x00
                  random
0000c7  00                DCB      0x00
                          DCDU     0x00000000
0000cc  000000            DCB      0x00,0x00,0x00
                  macdata
0000cf  00                DCB      0x00
                          DCDU     0x00000000
0000d4  000000            DCB      0x00,0x00,0x00
                  RxdStatus
0000d7  00                DCB      0x00
                  SynHead
0000d8  00                DCB      0x00
                  RxdFrameStatus
0000d9  00                DCB      0x00
                  NowLen
0000da  00                DCB      0x00
                  RxdTotalLen
0000db  00                DCB      0x00
                  Bcc
0000dc  00                DCB      0x00

;*** Start embedded assembler ***

#line 1 "..\\user\\app.c"
	AREA ||.rev16_text||, CODE, READONLY
	THUMB
	EXPORT |__asm___5_app_c_SHID____REV16|
#line 129 "D:\\Keil\\ARM\\CMSIS\\Include\\core_cmInstr.h"
|__asm___5_app_c_SHID____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE, READONLY
	THUMB
	EXPORT |__asm___5_app_c_SHID____REVSH|
#line 144
|__asm___5_app_c_SHID____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP
	AREA ||.emb_text||, CODE, READONLY
	THUMB
	EXPORT |BOOT_jump|
#line 59 "..\\user\\app.c"
|BOOT_jump| PROC
#line 60

 
 msr msp, r0
 msr psp, r0

 
 
 BX r1
	ENDP

;*** End   embedded assembler ***
